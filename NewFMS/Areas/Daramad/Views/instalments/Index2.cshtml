@model IEnumerable<NewFMS.WCF_Daramad.OBJ_SelectDataForTaghsit>
@using Ext.Net.MVC
@using Hogaf.ExtNet.UX
@using Ext.Net
@{
    var X = Html.X();
}

<style>
    .custom-BaratDar{
        margin-right: 124px!important;
    }
    .x-grid-row-summary {
        background-color: #d3e1f1;
    }
    .margincommand{
        margin:0 0 0 5px !important;
    }
</style>

<script>
    Ext.net.FilterHeader.behaviour.string[0].match = function (recordValue, matchValue) {
        return (Ext.net.FilterHeader.behaviour.getStrValue(recordValue) || "").indexOf(matchValue) > -1;
    };

    Ext.net.FilterHeader.behaviour.string[0].getStrValue = function (value) {
        return value.toString();
    };


    Ext.net.FilterHeader.behaviour.string[0].serialize = function (value) {
        return {
            type: "string",
            op: "*",
            value: value
        };
    };
</script>

@(Html.X().Window()
    .Closable(true)
    .CloseAction(CloseAction.Destroy)
    .Title("تقسیط")
    .Layout(LayoutType.Fit)
    .ID("Instalments")
    .Modal(true)
    .Listeners(l=>{
        l.AfterRender.Handler = "setSizeInstalments()";
        l.Render.Fn = "addKeyMapInstalments";
    })
    .Items(
        X.Panel()
            .Border(false)
            .Layout(LayoutType.VBox)
            .LayoutConfig(new VBoxLayoutConfig { Align = VBoxAlign.Center })
            .PaddingSpec("8px 12px 8px 12px")
            .Items(
                X.FieldSet()
                    .Border(false)
                    .Padding(0)
                    .Layout(LayoutType.HBox)
                    .Items(
                        X.Label("نوع سند:")
                            .PaddingSpec("0 3px 0 0"),
                        X.ComboBox()
                            .ItemID("CboDocType")
                            .PaddingSpec("0 0 0 10px")
                            .Editable(false)
                            .TypeAhead(true)
                            .AllowBlank(false)
                            .ForceSelection(true)
                            .BlankText("لطفا نوع سند را انتخاب کنید.")
                            .QueryMode(DataLoadMode.Local)
                            .TriggerAction(TriggerAction.All)
                            .EmptyText("نوع سند...")
                            .Listeners(l =>
                            {
                                l.Select.Handler = "showhideFieldset()";
                                l.AfterRender.Handler = "App.Instalments.queryById('CboDocType').setValue('1');showhideFieldset();";
                            })
                            .Items(
                                new ListItem("نقدی", "1"),
                                new ListItem("چک", "2"),
                                new ListItem("سفته", "3"),
                                new ListItem("برات", "4"),
                                new ListItem("بدهکاری", "5"),
                                new ListItem("بستانکاری", "7")
                                ),
                            X.Button()
                                .Icon(Icon.ReportGo)
                                .Text("گزارش گروهی بانک")
                                .MarginSpec("0 10px 0 0")
                                .Listeners(l => l.Click.Handler = "BankReportGroup()"),
                            X.Button()
                                .Icon(Icon.PageWhiteGet)
                                .Text("رسید به مؤدی")
                                .Listeners(l => l.Click.Handler = "GetReciept()")
                                    ),
                    X.FieldSet()
                        .Border(true)
                        .Title("اطلاعات سند")
                        .Layout(LayoutType.VBox)
                        .LayoutConfig(new Ext.Net.VBoxLayoutConfig { Align = VBoxAlign.Stretch })
                        .Defaults(new { Margin = 2 })
                        .Items(
                            X.Hidden().ItemID("Talab_NaghdiId"),
                            X.Hidden().ItemID("CheckId"),
                            X.Hidden().ItemID("BaratId"),
                            X.Hidden().ItemID("SaftehId"),                            
                            X.FieldSet()
                                .Layout(LayoutType.Table)
                                .LayoutConfig(new Ext.Net.TableLayoutConfig { Columns = 6 })
                                .Border(false)
                                .ItemID("FieldSetNaghdi")
                                .Defaults(new { margin = 2 })
                                .Padding(0)
                                .Items(
                                    X.Hidden().ItemID("fldShomareHesabIdPardakht_N"),        
                                    X.Label("مبلغ:"),
                                    X.TextField()
                                        .ItemID("TxtMablaghNa")
                                        .AutoFocus(true)
                                        .MaskRe("[0-9]")
                                        .Listeners(l =>
                                        {
                                            l.Change.Handler = "App.Instalments.queryById('TxtMablaghNa').setValue(accounting.formatNumber(App.Instalments.queryById('TxtMablaghNa').getValue()));";
                                            l.AfterRender.Handler = "setDefaultTxtMablaghNa()";
                                        })
                                        .AllowBlank(false)
                                        .BlankText("لطفا مبلغ را وارد کنید."),
                                    X.Label("شماره حساب سازمان:"),
                                    X.TextField()
                                        .ItemID("txtShomareHesabPardakht_N")
                                        .Icon(Icon.CoinsAdd)
                                        .EnableKeyEvents(true)
                                        .AllowBlank(false)
                                        .ReadOnly(true)
                                        .FieldStyle("padding-right:6px;")
                                        .BlankText("لطفا شماره حساب را انتخاب کنید.")
                                        .Listeners(l => l.AfterRender.Handler = "App.Instalments.queryById('txtShomareHesabPardakht_N').icon.dom.classList.add('custom-BaratDar');sh_pishfarz_NSetValue();")
                                        .DirectEvents(li =>
                                        {
                                            li.SpecialKey.Url = "/Comon/SearchShomareHesab/Index?State=10&AshkhasId=0";
                                            li.SpecialKey.Before = "return e.getKey() == Ext.EventObject.INSERT;";
                                            li.IconClick.Url = "/Comon/SearchShomareHesab/Index?State=10&AshkhasId=0";
                                        }),
                                    X.Label("توضیحات:"),
                                    X.TextField()
                                        .ItemID("txtDescNa"),
                                    X.FieldSet()
                                        .Border(false)
                                        .ItemID("btnFieldsetNaghdi")
                                        .ColSpan(6)
                                        .Listeners(l => l.AfterRender.Handler = "App.Instalments.queryById('btnFieldsetNaghdi').setWidth(App.DaramadWin.getWidth() - 720)")
                                        .Padding(0)
                                        .Layout(LayoutType.VBox)
                                        .LayoutConfig(new VBoxLayoutConfig{Align=VBoxAlign.Left})
                                        .Items(
                                            X.Button()
                                                .Text("اعمال سند")
                                                .ItemID("btnSanadNaghdi")
                                                .Listeners(l => l.Click.Handler = "setFieldIn('FieldSetNaghdi')")
                                                .Icon(Icon.TableRowInsert))
                                ),
                            X.FieldSet()
                                .Layout(LayoutType.Table)
                                .LayoutConfig(new Ext.Net.TableLayoutConfig { Columns = 6 })
                                .Border(false)
                                .ItemID("FieldSetTalab")
                                .Padding(0)
                                .Defaults(new { margin = 2 })
                                .Items(
                                    X.Label("مبلغ:"),
                                    X.TextField()
                                        .ItemID("TxtMablaghTa")
                                        .AutoFocus(true)
                                        .MaskRe("[0-9]")
                                        .Listeners(l => l.Change.Handler = "App.Instalments.queryById('TxtMablaghTa').setValue(accounting.formatNumber(App.Instalments.queryById('TxtMablaghTa').getValue()));")
                                        .AllowBlank(false)
                                        .BlankText("لطفا مبلغ را وارد کنید."),
                                    X.Label("توضیحات:"),
                                    X.TextField()
                                        .ItemID("txtDescTa"),
                                    X.Button()
                                        .Text("اعمال سند")
                                        .ItemID("btnSanadTalab")                                        
                                        .Listeners(l => l.Click.Handler = "setFieldIn('FieldSetTalab')")
                                        .Icon(Icon.TableRowInsert)
                                    ),
                            X.FieldSet()
                                .Layout(LayoutType.Table)
                                .LayoutConfig(new Ext.Net.TableLayoutConfig { Columns = 6 })
                                .Border(false)
                                .ItemID("FieldSetBestankar")
                                .Padding(0)
                                .Defaults(new { margin = 2 })
                                .Items(
                                    X.Label("مبلغ:"),
                                    X.TextField()
                                        .ItemID("TxtMablaghBes")
                                        .AutoFocus(true)
                                        .MaskRe("[0-9]")
                                        .Listeners(l => l.Change.Handler = "App.Instalments.queryById('TxtMablaghBes').setValue(accounting.formatNumber(App.Instalments.queryById('TxtMablaghBes').getValue()));")
                                        .AllowBlank(false)
                                        .BlankText("لطفا مبلغ را وارد کنید."),
                                    X.Label("توضیحات:"),
                                    X.TextField()
                                        .ItemID("txtDescBes"),
                                    X.Button()
                                        .Text("اعمال سند")
                                        .ItemID("btnSanadBes")
                                        .Listeners(l => l.Click.Handler = "setFieldIn('FieldSetBestankar')")
                                        .Icon(Icon.TableRowInsert)
                                    ),
                            X.FieldSet()
                                .Layout(LayoutType.Table)
                                .LayoutConfig(new Ext.Net.TableLayoutConfig { Columns = 6 })
                                .Border(false)
                                .Defaults(new { margin = 2 })
                                .ItemID("FieldSetCheck")
                                .Items(
                                    X.Hidden().ItemID("fldShomareHesabId"),
                                    X.Hidden().ItemID("fldShomareHesabIdPardakht"),                                    
                                    X.Label("نوع چک:"),
                                    X.ComboBox()
                                        .ItemID("CboTypeSanadCh")
                                        .Editable(false)
                                        .TypeAhead(true)
                                        .AllowBlank(false)
                                        .ForceSelection(true)
                                        .BlankText("لطفا نوع سند را انتخاب کنید.")
                                        .QueryMode(DataLoadMode.Local)
                                        .TriggerAction(TriggerAction.All)
                                        .EmptyText("نوع چک...")
                                        .Listeners(l =>
                                        {
                                            l.AfterRender.Handler = "App.Instalments.queryById('CboTypeSanadCh').setValue('0');";
                                            l.Change.Handler = "ChangeCboTypeSanadCh()";
                                        })
                                        .Items(
                                            new ListItem("عادی", "0"),
                                            new ListItem("ضمانتی", "1")
                                            ),
                                    X.Label("تاریخ سررسید:"),
                                    X.PDateField()
                                        .ItemID("txtTarikhSarResidCh")
                                        .AutoFocus(true)
                                        //.Listeners(l => l.Focus.Handler = "SetValidateForDate('txtTarikhSarResidCh')")
                                        .AllowBlank(false)
                                        .Editable(true)
                                        .MaskRe("/[0-9 /]/")
                                        .BlankText("لطفا تاریخ سررسید را وارد کنید.")
                                        .MaxLength(10)
                                        .EnforceMaxLength(true),
                                    X.Label("شماره سند:"),
                                    X.TextField()
                                        .ItemID("txtShomareSanadCh")
                                        .AllowBlank(false)
                                        .BlankText("لطفا شماره سند را وارد کنید.")
                                        .MaxLength(50)
                                        .EnforceMaxLength(true),
                                    X.Label("مبلغ:"),
                                    X.TextField()
                                        .ItemID("TxtMablaghSanadCh")
                                        .Listeners(l => l.Change.Handler = "App.Instalments.queryById('TxtMablaghSanadCh').setValue(accounting.formatNumber(App.Instalments.queryById('TxtMablaghSanadCh').getValue()));checkIntNumCheck('TxtMablaghSanadCh')")
                                        .AllowBlank(false)
                                        .BlankText("لطفا مبلغ را وارد کنید."),
                                    X.Label().Text("شماره حساب(INS):"),
                                    X.TextField()
                                        .ItemID("txtShomareHesab")
                                        .Icon(Icon.CoinsAdd)
                                        .EnableKeyEvents(true)
                                        .AllowBlank(false)
                                        .ReadOnly(true)
                                        .FieldStyle("padding-right:6px;")
                                        .BlankText("لطفا شماره حساب را انتخاب کنید.")
                                        .Listeners(l => l.AfterRender.Handler = "App.Instalments.queryById('txtShomareHesab').icon.dom.classList.add('custom-BaratDar');")
                                        .DirectEvents(li =>
                                        {
                                            li.SpecialKey.Url = "/Comon/SearchShomareHesab/Index?State=8&AshkhasId=0";
                                            li.SpecialKey.Before = "return e.getKey() == Ext.EventObject.INSERT;";
                                            li.IconClick.Url = "/Comon/SearchShomareHesab/Index?State=8&AshkhasId=0";
                                        }),
                                    X.Label("بانک:"),
                                    X.TextField()
                                        .ItemID("txtBank")
                                        .FieldStyle("background-image:none;background-color:#d3e1f1;")                                        
                                        .ReadOnly(true),
                                    X.Label("شعبه:"),
                                    X.TextField()
                                        .ItemID("txtShobe")
                                        .FieldStyle("background-image:none;background-color:#d3e1f1;")
                                        .ReadOnly(true),
                                    X.Label("وضعیت:"),
                                    X.ComboBox()
                                        .ItemID("CboStatusCh")
                                        .Editable(false)
                                        .TypeAhead(true)
                                        .AllowBlank(false)
                                        .ForceSelection(true)
                                        .BlankText("لطفا وضعیت را انتخاب کنید.")
                                        .QueryMode(DataLoadMode.Local)
                                        .TriggerAction(TriggerAction.All)
                                        .EmptyText("وضعیت...")
                                        //.ColSpan(2)
                                        .Listeners(l =>
                                        {
                                            l.Select.Handler = "setValidatetxtTarikhStatus('txtTarikhStatusCh',App.Instalments.queryById('CboStatusCh').getValue());";
                                            l.AfterRender.Handler = "App.Instalments.queryById('CboStatusCh').setValue('1');";
                                        })
                                        .Items(
                                            new ListItem("در انتظار وصول", "1"),
                                            new ListItem("وصول شده", "2"),
                                            new ListItem("برگشت خورده", "3"),
                                            new ListItem("حقوقی شده", "4"),
                                            new ListItem("عودت داده شده", "5")
                                            ),
                                        X.Label("تاریخ تغییر وضعیت:"),
                                        X.PDateField()
                                            .ItemID("txtTarikhStatusCh")
                                            //.Listeners(l => l.Focus.Handler = "SetValidateForDate('txtTarikhStatusCh')")
                                            //.AllowBlank(false)
                                            .Editable(true)
                                            .MaskRe("/[0-9 /]/")
                                            .BlankText("لطفا تاریخ تغییر وضعیت را وارد کنید.")
                                            .MaxLength(10)
                                            .EnforceMaxLength(true),
                                        X.Label().Text("شماره حساب سازمان:"),
                                        X.TextField()
                                            .ItemID("txtShomareHesabPardakht")
                                            .Icon(Icon.CoinsAdd)
                                            .EnableKeyEvents(true)
                                            .AllowBlank(false)
                                            .ReadOnly(true)
                                            .FieldStyle("padding-right:6px;")
                                            .BlankText("لطفا شماره حساب را انتخاب کنید.")
                                            .Listeners(l => l.AfterRender.Handler = "App.Instalments.queryById('txtShomareHesabPardakht').icon.dom.classList.add('custom-BaratDar');sh_pishfarzSetValue();")
                                            .DirectEvents(li =>
                                            {
                                                li.SpecialKey.Url = "/Comon/SearchShomareHesab/Index?State=9&AshkhasId=0";
                                                li.SpecialKey.Before = "return e.getKey() == Ext.EventObject.INSERT;";
                                                li.IconClick.Url = "/Comon/SearchShomareHesab/Index?State=9&AshkhasId=0";
                                            }),
                                    X.Label("توضیحات:"),
                                    X.TextField()
                                        .ItemID("txtDescCh")
                                        .ColSpan(2),
                                    /*X.FieldSet()
                                            .Border(false)
                                            .ItemID("btnFieldsetCheck")
                                            .ColSpan(6)
                                            .Listeners(l => l.AfterRender.Handler = "App.Instalments.queryById('btnFieldsetCheck').setWidth(App.DaramadWin.getWidth() - 700)")
                                            .Padding(0)
                                            .Layout(LayoutType.VBox)
                                            .LayoutConfig(new VBoxLayoutConfig{Align=VBoxAlign.Left})
                                            .Items(*/
                                    X.Button()
                                        .Text("اعمال سند")
                                        .ItemID("btnSanadCh")                                        
                                        .Listeners(l => l.Click.Handler = "setFieldIn('FieldSetCheck')")
                                        .Icon(Icon.TableRowInsert)
                                                    /*)*/
                                ),
                            X.FieldSet()
                                .Border(false)
                                .Layout(LayoutType.VBox)
                                .LayoutConfig(new VBoxLayoutConfig { Align = VBoxAlign.Center })
                                .Items(
                                    X.FieldSet()
                                        .Layout(LayoutType.Table)
                                        .LayoutConfig(new Ext.Net.TableLayoutConfig { Columns = 6 })
                                        .ItemID("FieldSetSafteh")
                                        .Padding(0)
                                        .Defaults(new { margin = 2 })
                                        .Border(false)
                                        .Items(
                                            X.Label("تاریخ سررسید:"),
                                            X.PDateField()
                                                .ItemID("txtTarikhSarResidS")
                                                .AutoFocus(true)
                                                //.Listeners(l => l.Focus.Handler = "SetValidateForDate('txtTarikhSarResidS')")                                                
                                                .AllowBlank(false)
                                                .Editable(true)
                                                .MaskRe("/[0-9 /]/")
                                                .BlankText("لطفا تاریخ سررسید را وارد کنید.")
                                                .MaxLength(10)
                                                .EnforceMaxLength(true),
                                            X.Label("شماره سند:"),
                                            X.TextField()
                                                .ItemID("txtShomareSanadS")
                                                .AllowBlank(false)
                                                .BlankText("لطفا شماره سند را وارد کنید.")
                                                .MaxLength(50)
                                                .EnforceMaxLength(true),
                                            X.Label("مبلغ:"),
                                            X.TextField()
                                                .ItemID("TxtMablaghSanadS")
                                                .MaskRe("[0-9]")
                                                .Listeners(l => l.Change.Handler = "App.Instalments.queryById('TxtMablaghSanadS').setValue(accounting.formatNumber(App.Instalments.queryById('TxtMablaghSanadS').getValue()));checkIntNumCheck('TxtMablaghSanadS')")
                                                .AllowBlank(false)
                                                .BlankText("لطفا مبلغ را وارد کنید."),
                                            X.Label("وضعیت:"),
                                            X.ComboBox()
                                                .ItemID("CboStatusS")
                                                .Editable(false)
                                                .TypeAhead(true)
                                                .AllowBlank(false)
                                                .ForceSelection(true)
                                                .BlankText("لطفا وضعیت را انتخاب کنید.")
                                                .QueryMode(DataLoadMode.Local)
                                                .TriggerAction(TriggerAction.All)
                                                .EmptyText("وضعیت...")
                                                .Listeners(l =>
                                                {
                                                    l.Select.Handler = "setValidatetxtTarikhStatus('txtTarikhStatusS',App.Instalments.queryById('CboStatusS').getValue());";
                                                    l.AfterRender.Handler = "App.Instalments.queryById('CboStatusS').setValue('1');";
                                                })
                                                .Items(
                                                    new ListItem("در انتظار وصول", "1"),
                                                    new ListItem("وصول شده", "2"),
                                                    new ListItem("نکول شده", "3"),
                                                    new ListItem("حقوقی شده", "4"),
                                                    new ListItem("عودت داده شده", "5")
                                                    ),
                                             X.Label("تاریخ تغییر وضعیت:"),
                                            X.PDateField()
                                                .ItemID("txtTarikhStatusS")
                                                //.Listeners(l => l.Focus.Handler = "SetValidateForDate('txtTarikhStatusS')")
                                                //.AllowBlank(false)
                                                .Editable(true)
                                                .MaskRe("/[0-9 /]/")
                                                .BlankText("لطفا تاریخ تغییر وضعیت را وارد کنید.")
                                                .MaxLength(10)
                                                .EnforceMaxLength(true),
                                            X.Label("توضیحات:"),
                                            X.TextField()
                                                .ItemID("txtDescS")
                                                .ColSpan(2),
                                            X.FieldSet()
                                               .Border(false)
                                               .ItemID("btnFieldsetSafteh")
                                               .ColSpan(6)
                                                .Listeners(l => l.AfterRender.Handler = "App.Instalments.queryById('btnFieldsetSafteh').setWidth(App.DaramadWin.getWidth() - 695)")
                                               .Padding(0)
                                               .Layout(LayoutType.VBox)
                                               .LayoutConfig(new VBoxLayoutConfig{Align=VBoxAlign.Left})
                                               .Items(
                                                    X.Button()
                                                        .Text("اعمال سند")
                                                        .ItemID("btnSanadSafte")
                                                        .Listeners(l => l.Click.Handler = "setFieldIn('FieldSetSafteh')")
                                                        .Icon(Icon.TableRowInsert)
                                                        )
                                            )),
                            X.FieldSet()
                                .Border(false)
                                .Layout(LayoutType.VBox)
                                .LayoutConfig(new VBoxLayoutConfig { Align = VBoxAlign.Center })
                                .Items(
                                    X.FieldSet()
                                        .Layout(LayoutType.Table)
                                        .LayoutConfig(new Ext.Net.TableLayoutConfig { Columns = 6 })
                                        .ItemID("FieldSetBarat")
                                        .Defaults(new { margin = 2 })
                                        .Border(false)
                                        .Items(
                                            X.Hidden().ItemID("fldBaratDarId"),
                                            X.Label("تاریخ سررسید:"),
                                            X.PDateField()
                                                .ItemID("txtTarikhSarResidB")
                                                .AutoFocus(true)
                                                //.Listeners(l => l.Focus.Handler = "SetValidateForDate('txtTarikhSarResidB')")
                                                .AllowBlank(false)
                                                .Editable(true)
                                                .MaskRe("/[0-9 /]/")
                                                .BlankText("لطفا تاریخ سررسید را وارد کنید.")
                                                .MaxLength(10)
                                                .EnforceMaxLength(true),
                                            X.Label("شماره سند:"),
                                            X.TextField()
                                                .ItemID("txtShomareSanadB")
                                                .AllowBlank(false)
                                                .BlankText("لطفا شماره سند را وارد کنید.")
                                                .MaxLength(50)
                                                .EnforceMaxLength(true),
                                            X.Label("مبلغ:"),
                                            X.TextField()
                                                .ItemID("TxtMablaghSanadB")
                                                .Listeners(l => l.Change.Handler = "App.Instalments.queryById('TxtMablaghSanadB').setValue(accounting.formatNumber(App.Instalments.queryById('TxtMablaghSanadB').getValue()));checkIntNumCheck('TxtMablaghSanadB')")
                                                .AllowBlank(false)
                                                .MaskRe("[0-9]")
                                                .BlankText("لطفا مبلغ را وارد کنید."),
                                            X.Label()
                                                .Text("برات دار(INS):")
                                                .ItemID("lblName"),
                                            X.TextField()
                                                .ItemID("txtBaratDar")
                                                .Icon(Icon.UserAdd)
                                                .EnableKeyEvents(true)
                                                .AllowBlank(false)
                                                .ReadOnly(true)
                                                .FieldStyle("padding-right:6px;")
                                                .BlankText("لطفا شخص برات دار را انتخاب کنید.")
                                                .Listeners(l => l.AfterRender.Handler = "App.Instalments.queryById('txtBaratDar').icon.dom.classList.add('custom-BaratDar');")
                                                .DirectEvents(li =>
                                                {
                                                    li.SpecialKey.Url = "/Daramad/SearchAshkhas/Index?State=3";
                                                    li.SpecialKey.Before = "return e.getKey() == Ext.EventObject.INSERT;";
                                                    li.IconClick.Url = "/Daramad/SearchAshkhas/Index?State=3";
                                                }),
                                            X.Label("مکان پرداخت:"),
                                            X.TextField()
                                                .ItemID("txtMakanPardakhtB")
                                                .AllowBlank(false)
                                                .BlankText("لطفا مکان پرداخت را وارد کنید."),
                                            X.Label("وضعیت:"),
                                            X.ComboBox()
                                                .ItemID("CboStatusB")
                                                .Editable(false)
                                                .TypeAhead(true)
                                                .AllowBlank(false)
                                                .ForceSelection(true)
                                                .BlankText("لطفا وضعیت را انتخاب کنید.")
                                                .QueryMode(DataLoadMode.Local)
                                                .TriggerAction(TriggerAction.All)
                                                .EmptyText("وضعیت...")
                                                .Listeners(l =>
                                                {
                                                    l.Select.Handler = "setValidatetxtTarikhStatus('txtTarikhStatusB',App.Instalments.queryById('CboStatusB').getValue());";                                                    
                                                    l.AfterRender.Handler = "App.Instalments.queryById('CboStatusB').setValue('1');";
                                                })
                                                .Items(
                                                    new ListItem("در انتظار وصول", "1"),
                                                    new ListItem("وصول شده", "2"),
                                                    new ListItem("نکول شده", "3"),
                                                    new ListItem("حقوقی شده", "4"),
                                                    new ListItem("عودت داده شده", "5")
                                                    ),
                                            X.Label("تاریخ تغییر وضعیت:"),
                                            X.PDateField()
                                                .ItemID("txtTarikhStatusB")
                                                //.Listeners(l => l.Focus.Handler = "SetValidateForDate('txtTarikhStatusB')")
                                                //.AllowBlank(false)
                                                .Editable(true)
                                                .MaskRe("/[0-9 /]/")
                                                .BlankText("لطفا تاریخ تغییر وضعیت را وارد کنید.")
                                                .MaxLength(10)
                                                .EnforceMaxLength(true),
                                            X.Label("توضیحات:"),
                                            X.TextField()
                                                .ItemID("txtDescB")
                                                .ColSpan(2),
                                            X.Button()
                                                .Text("اعمال سند")
                                                .ItemID("btnSanadBarat")
                                                .Listeners(l => l.Click.Handler = "setFieldIn('FieldSetBarat')")
                                                .Icon(Icon.TableRowInsert)
                                                    )
                                        )
                                    ),
                            X.GridPanel()
                                .TopBar(
                                    Html.X().Toolbar()
                                        .Items(
                                            X.Button()
                                                .Text("ذخیره")
                                                .Icon(Ext.Net.Icon.Disk)
                                                .Listeners(l => { l.Click.Handler = "SaveInstalments();"; })
                                        )
                                    )
                                    .ItemID("InstalmentsGrid")
                                    .AutoScroll(true)
                                    .Height(300)
                                    .Features(Html.X().Summary().ID("summaryInstalment").Dock(SummaryDock.Bottom))
                                    .Store(
                                        X.StoreForModel()
                                            .Listeners(l => {
                                                l.DataChanged.Handler = "App.Instalments.queryById('InstalmentsGrid').selModel.refresh();";
                                                l.Load.Handler = "showhideCommandColumn()";
                                            })
                                            .Proxy(Html.X().AjaxProxy()
                                                .Url(Url.Action("Read"))
                                                .Reader(Html.X().JsonReader().Root("data"))
                                                .ExtraParams(x => x.Add(new { ReplyTaghsitId = @ViewBag.ReplyTaghsitId }))
                                                    )
                                            .RemoteFilter(true)
                                            .RemotePaging(true)
                                        )
                                    .View(
                                        Html.X().GridView().LoadingText("در حال بارگذاری...").RTL(true)
                                        )
                                    .Plugins(X.FilterHeader().Remote(false))
                                    .ColumnModel(
                                        //Html.X().RowNumbererColumn(),
                                            Html.X().ImageCommandColumn().PrepareCommand("hideReportBank").Listeners(l => l.Command.Fn = "ActionDoc").Flex(5)
                                            .Commands(
                                                Html.X().ImageCommand().Cls("margincommand").CommandName("CopyCommand").Icon(Icon.PageCopy).ToolTip(tt => tt.Text = "کپی از چک"),
                                                Html.X().ImageCommand().Cls("margincommand").CommandName("BackCommand").IconCls("BackCheck").ToolTip(tt => tt.Text = "عودت"),
                                                Html.X().ImageCommand().Cls("margincommand").CommandName("DelCommand").Icon(Icon.Delete).ToolTip(tt => tt.Text = "حذف"),
                                                Html.X().ImageCommand().Cls("margincommand").CommandName("EditCommand").Icon(Icon.Pencil).ToolTip(tt => tt.Text = "ویرایش"),
                                                Html.X().ImageCommand().Cls("margincommand").CommandName("RptBankCommand").IconCls("ReportBank").ToolTip(tt => tt.Text = "گزارش بانک")
                                                ),
                                        Html.X().Column().DataIndex(Model, m => m.fldId).Text("کد").Hidden(true).Flex(1),
                                        Html.X().Column().DataIndex(Model, m => m.fldShomareSanad).Text("شماره سند").Flex(3).Wrap(true),
                                        Html.X().Column().DataIndex(Model, m => m.fldTarikhSarResid).Text("تاریخ سررسید").Flex(4).Wrap(true),
                                        Html.X().Column().DataIndex(Model, m => m.fldStatus).Text("کد وضعیت").Flex(1).Hidden(true).Wrap(true),
                                        Html.X().Column().DataIndex(Model, m => m.fldStatusName).Text("وضعیت").Flex(4).Wrap(true),
                                        Html.X().Column().DataIndex(Model, m => m.fldDateStatus).Text("تاریخ تغییر وضعیت").Flex(4).Hidden(true).Wrap(true),
                                        Html.X().Column().DataIndex(Model, m => m.fldTypeSanadName).Text("نوع سند").Flex(3).Wrap(true),
                                        Html.X().Column().DataIndex(Model, m => m.fldTypeSanad).Text("کد نوع سند").Flex(1).Hidden(true).Wrap(true),                                        
                                        Html.X().Column().DataIndex(Model, m => m.fldShomareHesab).Text("شماره حساب چک").Flex(5).Wrap(true),
                                        Html.X().Column().DataIndex(Model, m => m.fldShomareHesabOrgan).Text("شماره حساب سازمان").Flex(5).Wrap(true),                                        
                                        Html.X().Column().DataIndex(Model, m => m.fldShomareHesabId).Hidden(true).Text("کد شماره حساب").Flex(2),
                                        Html.X().Column().DataIndex(Model, m => m.fldShomareHesabIdOrgan).Hidden(true).Text("کد شماره حساب ارگان").Flex(2),                                      
                                        Html.X().Column().DataIndex(Model, m => m.fldBankName).Text("بانک").Hidden(true).Flex(2).Wrap(true),
                                        Html.X().Column().DataIndex(Model, m => m.fldNameShobe).Text("شعبه").Hidden(true).Flex(3).Wrap(true),
                                        Html.X().Column().DataIndex(Model, m => m.fldNameBaratDar).Text("برات دار").Flex(4).Wrap(true),
                                        Html.X().Column().DataIndex(Model, m => m.fldBaratDarId).Hidden(true).Text("کد شخص").Flex(2),                                        
                                        Html.X().Column().DataIndex(Model, m => m.fldMakanPardakht).Text("محل پرداخت").Flex(4).Wrap(true),
                                        Html.X().Column().DataIndex(Model, m => m.fldMablaghSanad).Text("مبلغ سند").Flex(4).Wrap(true).Renderer("SepearateAccount").SummaryRenderer(new Renderer { Handler = "totalDocMablagh" }),
                                            Html.X().Column().DataIndex(Model, m => m.fldDesc).Text("توضیحات").Flex(6).Wrap(true),  
                                        Html.X().CommandColumn().ID("CommandColumnInstalment").Flex(6).PrepareToolbar("disableSodorCommand").Listeners(ls => ls.Command.Fn = "SodorFishInstalment")
                                        .Commands(
                                            Html.X().GridCommand()
                                                .CommandName("SodorCommand")
                                                .StandOut(true)
                                                .MinWidth(50)
                                                .Text("صدور فیش")
                                                .ToolTip(tt => tt.Text = "صدور فیش"),
                                            Html.X().GridCommand()
                                                .CommandName("CancleCommand")
                                                .StandOut(true)
                                                .MinWidth(50)
                                                .Text("ابطال فیش")
                                                .ToolTip(tt => tt.Text = "ابطال فیش")
                                                )
                                    )
                                    .SelectionModel(
                                        Html.X().RowSelectionModel()
                                            .Mode(Ext.Net.SelectionMode.Single)
                        )
            )
    )
)

<script type="text/javascript">
    var recordd = null;
    var DelArray = new Array();

    function sh_pishfarzSetValue() {
        App.Instalments.queryById('txtShomareHesabPardakht').setValue('@ViewBag.fldShomareHesabPishfarz');
        App.Instalments.queryById('fldShomareHesabIdPardakht').setValue('@ViewBag.fldShomareHesabPishfarzId');
    }

    function sh_pishfarz_NSetValue() {
        App.Instalments.queryById('txtShomareHesabPardakht_N').setValue('@ViewBag.fldShomareHesabPishfarz');
        App.Instalments.queryById('fldShomareHesabIdPardakht_N').setValue('@ViewBag.fldShomareHesabPishfarzId');
    }

    function showhideCommandColumn() {
        var store = App.Instalments.queryById('InstalmentsGrid').store;
        App.CommandColumnInstalment.hide();
        store.each(function (rec) {
            if (rec.get('fldTypeSanad') == 1 && rec.get('fldId') != 0) {
                App.CommandColumnInstalment.show();
                return;
            }
        });
    }

    function checkIntNumCheck(field) {
        if (field == "TxtMablaghSanadCh") {
            if (App.Instalments.queryById("CboTypeSanadCh").getValue() == "1" || App.Instalments.queryById("CboStatusCh").getValue() == "5") {
                if (parseInt(App.Instalments.queryById(field).getValue().replace(',', '').replace(',', '').replace(',', '').replace(',', '')) > 2147483647) {
                    App.Instalments.queryById(field).setValue("");
                    Ext.MessageBox.show({
                        title: "خطا",
                        msg: "مقدار وارد شده بیشتر از حد مجاز است.",
                        icon: Ext.MessageBox.ERROR,
                        buttons: Ext.MessageBox.OK
                    });
                }
            }
        }
        else if (field == "TxtMablaghSanadS") {
            if (App.Instalments.queryById("CboStatusS").getValue() == "5") {
                if (parseInt(App.Instalments.queryById(field).getValue().replace(',', '').replace(',', '').replace(',', '').replace(',', '')) > 2147483647) {
                    App.Instalments.queryById(field).setValue("");
                    Ext.MessageBox.show({
                        title: "خطا",
                        msg: "مقدار وارد شده بیشتر از حد مجاز است.",
                        icon: Ext.MessageBox.ERROR,
                        buttons: Ext.MessageBox.OK
                    });
                }
            }
        }
        else if (field == "TxtMablaghSanadB") {
            if (App.Instalments.queryById("CboStatusB").getValue() == "5") {
                if (parseInt(App.Instalments.queryById(field).getValue().replace(',', '').replace(',', '').replace(',', '').replace(',', '')) > 2147483647) {
                    App.Instalments.queryById(field).setValue("");
                    Ext.MessageBox.show({
                        title: "خطا",
                        msg: "مقدار وارد شده بیشتر از حد مجاز است.",
                        icon: Ext.MessageBox.ERROR,
                        buttons: Ext.MessageBox.OK
                    });
                }
            }
        }
    }

    var hideReportBank = function (grid, command, record, row) {
        if (command.command == 'RptBankCommand') {
            if (record.data.fldTypeSanad == 2 && record.data.fldId != 0) {/*چک عادی*/
                command.hidden = false;
                command.hideMode = 'visibility';
            }
            else {
                command.hidden = true;
                command.hideMode = 'visibility';
            }
        }
        else if (command.command == 'BackCommand') {
            if (record.data.fldTypeSanad != 1 && record.data.fldTypeSanad != 5 && record.data.fldTypeSanad != 7) {
                command.hidden = false;
                command.hideMode = 'visibility';
            }
            else {
                command.hidden = true;
                command.hideMode = 'visibility';
            }
        }
        else if (command.command == "CopyCommand") {
            if (record.data.fldTypeSanad != 1 && record.data.fldTypeSanad != 5 && record.data.fldTypeSanad != 7 && record.data.fldStatus == 1) {
                command.hidden = false;
                command.hideMode = 'visibility';
            }
            else {
                command.hidden = true;
                command.hideMode = 'visibility';
            }
        }
    };

    function setSizeInstalments() {
        App.Instalments.setWidth(App.DaramadWin.getWidth() - 260);
        App.Instalments.queryById('InstalmentsGrid').setWidth(App.DaramadWin.getWidth() - 300);
    }

    function setDefaultTxtMablaghNa() {
        App.Instalments.queryById('TxtMablaghNa').setValue('@ViewBag.fldMablaghNaghdi');
    }

    var SepearateAccount = function (value) {
        return value.toLocaleString();
    };

    var disableSodorCommand = function (grid, toolbar, rowIndex, record) {
        var Button = toolbar.items.get(0);
        var Button1 = toolbar.items.get(1);

        if (record.data.fldTypeSanad != 1) {
            Button.setVisible(false);
            Button1.setVisible(false);
        }
        else {
            if (record.data.fldId != 0) {
                if (record.data.fldStatusFishId == "1" || record.data.fldStatusFishId == "3") {
                    Button.setDisabled(false);
                    Button1.setDisabled(true);
                }
                else {
                    Button.setDisabled(true);
                    Button1.setDisabled(false);
                }
            }
            else {
                Button.setVisible(false);
                Button1.setVisible(false);
            }
        }
    };

    function BankReportGroup() {
        var grid = App.Instalments.queryById('InstalmentsGrid');
        var ExistCheck = false;
        var records = Ext.Array.filter(
            grid.store.data.items,
            function (r) {
                if (r.get('fldTypeSanad') == 2) {/*چک عادی*/
                    ExistCheck = true;
                    return;
                }
            }
        );

        if (ExistCheck == true) {
            Ext.net.Mask.show({ msg: 'در حال چاپ گزارش...' });
            Ext.net.DirectMethod.request({
                url: '/Daramad/instalments/PrintCheck',
                params: {
                    CheckId: 0,
                    OrganId: '@ViewBag.OrganId',
                    ReplyTaghsitId:'@ViewBag.ReplyTaghsitId',
                },
                success: function () {
                    Ext.net.Mask.hide();
                }
            });
        }
        else {
            Ext.MessageBox.show({
                title: "خطا",
                msg: "چک جهت چاپ گزارش ثبت نشده است.",
                icon: Ext.MessageBox.ERROR,
                buttons: Ext.MessageBox.OK
            });
        }
    }

    function GetReciept() {
        var grid = App.Instalments.queryById('InstalmentsGrid');
        var ExistSaved = false;
        var records = Ext.Array.filter(
            grid.store.data.items,
            function (r) {
                if (r.get('fldId') != 0 && r.get('fldTypeSanad') != "1" && r.get('fldTypeSanad') != "5" && r.get('fldTypeSanad') != "7") {
                    ExistSaved = true;
                    return;
                }
            }
        );
        /*var records = Ext.Array.filter(
            grid.store.data.items,
            function (r) {
                return App.Instalments.queryById('InstalmentsGrid').store.indexOf('' + r.get('fldId')) != 0;
            }
        );*/

        if (ExistSaved == true) {
            Ext.net.Mask.show({ msg: 'در حال چاپ رسید...' });
            Ext.net.DirectMethod.request({
                url: '/Daramad/instalments/PrintReciept',
                params: {
                    ElameAvarezId: '@ViewBag.ElameAvarezId',
                    ReplyTaghsitId: '@ViewBag.ReplyTaghsitId',
                    OrganId: '@ViewBag.OrganId'
                },
                success: function () {
                    Ext.net.Mask.hide();
                }
            });
        }
        else {
            Ext.MessageBox.show({
                title: "خطا",
                msg: "سندی جهت رسید به مودی ثبت نشده است.",
                icon: Ext.MessageBox.ERROR,
                buttons: Ext.MessageBox.OK
            });
        }
    }

    var SodorFishInstalment = function (column, commandd, record) {
        if (commandd == "SodorCommand") {
            Ext.net.Mask.show({ msg: 'در حال صدور فیش...' });
            Ext.net.DirectMethod.request({
                url: '/Daramad/instalments/SodorFish',
                params: {
                    ElameAvarezId: '@ViewBag.ElameAvarezId',
                    Mablagh: record.get('fldMablaghSanad'),
                    Id: record.get('fldId'),
                    OrganId: '@ViewBag.OrganId',
                    State: 1,
                    FishId: 0,
                    ShomareHesabId: record.get('fldShomareHesabIdOrgan')
                },
                success: function (data) {
                    if (data.Er == 1) {
                        Ext.MessageBox.show({
                            title: data.MsgTitle,
                            msg: data.Msg,
                            icon: Ext.MessageBox.ERROR,
                            buttons: Ext.MessageBox.OK
                        });
                    }
                    else {
                        Ext.MessageBox.show({
                            title: "عملیات موفق",
                            msg: "صدور فیش با موفقیت انجام شد. آیا مایل به مشاهده پیش نمایش فیش هستید؟",
                            icon: Ext.MessageBox.INFO,
                            buttons: Ext.MessageBox.YESNO,
                            fn: function (btn) {
                                if (btn == 'yes') {
                                    Ext.net.Mask.show({ msg: 'در حال چاپ...' });
                                    Ext.net.DirectMethod.request({
                                        url: '/Daramad/AnnouncementComplications_Fish/Print',
                                        params: {
                                            FishId: data.FishId,
                                            ElamAvarezId: '@ViewBag.ElameAvarezId'
                                        },
                                        success: function () {
                                            Ext.net.Mask.hide();
                                        }
                                    });
                                }
                            }
                        });
                    }
                    App.Instalments.queryById('InstalmentsGrid').store.load();
                    Ext.net.Mask.hide();
                }
            });
        }
        else {
            Ext.net.Mask.show({ msg: 'در حال ابطال فیش...' });
            Ext.net.DirectMethod.request({
                url: '/Daramad/instalments/SodorFish',
                params: {
                    ElameAvarezId: '@ViewBag.ElameAvarezId',
                    Mablagh: record.get('fldMablaghSanad'),
                    Id: record.get('fldId'),
                    OrganId: '@ViewBag.OrganId',
                    FishId: record.get('fldFishId'),
                    State: 2,
                    ShomareHesabId:record.get('fldShomareHesabIdOrgan')
                },
                success: function (data) {
                    var ic = Ext.MessageBox.INFO;
                    if (data.Er == 1)
                        ic = Ext.MessageBox.ERROR;
                    Ext.MessageBox.show({
                        title: data.MsgTitle,
                        msg: data.Msg,
                        icon: ic,
                        buttons: Ext.MessageBox.OK
                    });
                    App.Instalments.queryById('InstalmentsGrid').store.load();
                    Ext.net.Mask.hide();
                }
            });
        }
    };

    function totalDocMablagh() {
        var store = App.Instalments.queryById('InstalmentsGrid').store;
        var sum = 0;
        store.each(function (rec) {
            if (rec.get('fldTypeSanad') != 6 && rec.get('fldStatus') != 5) {
                if (rec.get('fldTypeSanad') == 7) {
                    sum -= rec.get('fldMablaghSanad');
                }
                else {
                    sum += rec.get('fldMablaghSanad');
                }
            }
        });
        /*var sum = store.sum('fldMablaghSanad');*/

        var Mande = parseInt('@ViewBag.fldMablaghGHabelPardakht') - sum;
        var MandeHtml = "";
        if (parseInt(Mande) == 0) {
            MandeHtml="<div style='display:inline;'>مانده:</div>"+"<div style='display:inline;color:black;'>" + Mande.toLocaleString();
        }
        else {
            MandeHtml="<div style='display:inline;'>مانده:</div>"+"<div style='display:inline;color:red;'>" + Mande.toLocaleString();

        }
        if (sum == parseInt('@ViewBag.fldMablaghGHabelPardakht')) {
            return "<div style='display:inline;'>جمع وصولی:</div>" + "<div style='display:inline;color:black;'>" + sum.toLocaleString() + "</div>" + "</br>" + "جمع کل:" + parseInt('@ViewBag.fldMablaghGHabelPardakht').toLocaleString() + "</br>" + MandeHtml;
        }
        else {
            return "<div style='display:inline;'>جمع وصولی:</div>" + "<div style='display:inline;color:red;'>" + sum.toLocaleString() + "</div>" + "</br>" + "جمع کل:" + parseInt('@ViewBag.fldMablaghGHabelPardakht').toLocaleString() + "</br>" + MandeHtml;
        }
    }

    function ChangeCboTypeSanadCh() {
        var CboTypeSanadCh = App.Instalments.queryById('CboTypeSanadCh').getValue();
        var txtTarikhSarResidCh = App.Instalments.queryById('txtTarikhSarResidCh');
        if (CboTypeSanadCh == 0) {
            txtTarikhSarResidCh.allowBlank = false;
            txtTarikhSarResidCh.validate();
        }
        else {
            txtTarikhSarResidCh.allowBlank = true;
            txtTarikhSarResidCh.validate();
        }
    }

    function SetValidateForDate(field) {
        var txtTarikh = App.Instalments.queryById(field);
        var date = new Date('@ViewBag.Date');
        if (recordd == null) {
            txtTarikh.setMinValue(date);
            txtTarikh.minText = "تاریخ سررسید نمی تواند قبل از امروز باشد.";
        }
    }

    function setValidatetxtTarikhStatus(field, value) {
        if (value != "1") {
            App.Instalments.queryById(field).allowBlank = false;
            App.Instalments.queryById(field).validate();
        }
        else {
            App.Instalments.queryById(field).allowBlank = true;
            App.Instalments.queryById(field).validate();
        }
    }

    function setFieldIn(field) {
        if (field == "FieldSetNaghdi") {
            var store = App.Instalments.queryById('InstalmentsGrid').store;
            var sum1 = 0;
            store.each(function (rec) {
                if (rec.get('fldTypeSanad') != 6 && rec.get('fldStatus') != 5) {
                    if (rec.get('fldTypeSanad') == 7) {
                        sum1 -= rec.get('fldMablaghSanad');
                    }
                    else {
                        sum1 += rec.get('fldMablaghSanad');
                    }
                }
            });

            var Mablagh = App.Instalments.queryById('TxtMablaghNa').getValue();
            var txtDesc = App.Instalments.queryById('txtDescNa').getValue();
            var txtShomareHesabPardakht_N = App.Instalments.queryById('txtShomareHesabPardakht_N').getValue();
            var fldShomareHesabIdPardakht_N = App.Instalments.queryById('fldShomareHesabIdPardakht_N').getValue();

            if (recordd == null) {/*مود ذخیره*/
                /*var index = App.Instalments.queryById('InstalmentsGrid').store.findExact("fldTypeSanad", 1);*/
                /*var indexBack = App.Instalments.queryById('InstalmentsGrid').store.findExact("fldStatus", 5);*/
                @*if (indexBack == -1) {/*هیچ سندی عودت داده نشده*/
                    if (index == -1) {
                        if (Mablagh != 0) {
                            if (parseInt(Mablagh.replace(',', '').replace(',', '').replace(',', '').replace(',', '').replace(',', '')) <= (parseInt('@ViewBag.fldMablaghGHabelPardakht') - sum1)) {
                                App.Instalments.queryById('InstalmentsGrid').store.insert(0, { fldId: 0, fldMablaghSanad: Mablagh, fldTypeSanadName: "نقدی", fldTypeSanad: 1, fldStatusFishId: "1", fldStatusFish: "صادر نشده", fldDesc: txtDesc, fldShomareHesabOrgan: txtShomareHesabPardakht_N, fldShomareHesabIdOrgan: fldShomareHesabIdPardakht_N });
                                App.Instalments.queryById('TxtMablaghNa').setValue("");
                                App.Instalments.queryById('txtDescNa').setValue("");
                                if (App.Instalments.queryById('txtShomareHesabPardakht_N').getValue() != '@ViewBag.fldShomareHesabPishfarz') {
                                    App.Instalments.queryById('txtShomareHesabPardakht_N').setValue("");
                                    App.Instalments.queryById('fldShomareHesabIdPardakht_N').setValue(0);
                                }
                                /*App.Instalments.queryById('Talab_NaghdiId').setValue(0);*/
                                totalDocMablagh();
                            }
                            else {
                                Ext.MessageBox.show({
                                    title: "خطا",
                                    msg: "جمع مبالغ وارد شده نباید بیشتر از مبلغ کل باشد.",
                                    icon: Ext.MessageBox.ERROR,
                                    buttons: Ext.MessageBox.OK
                                });
                            }
                        }
                        else {
                            Ext.MessageBox.show({
                                title: "خطا",
                                msg: "لطفا مبلغ را وارد کنید.",
                                icon: Ext.MessageBox.ERROR,
                                buttons: Ext.MessageBox.OK
                            });
                        }
                    }
                    else {
                        Ext.MessageBox.show({
                            title: "خطا",
                            msg: "امکان اعمال مجدد سند نقدی وجود ندارد.",
                            icon: Ext.MessageBox.ERROR,
                            buttons: Ext.MessageBox.OK
                        });
                    }
                }
                else {/*سند عودت داده شده داریم*/*@
                    if (Mablagh != 0) {
                        if (parseInt(Mablagh.replace(',', '').replace(',', '').replace(',', '').replace(',', '').replace(',', '')) <= (parseInt('@ViewBag.fldMablaghGHabelPardakht') - sum1)) {
                            App.Instalments.queryById('InstalmentsGrid').store.insert(0, { fldId: 0, fldMablaghSanad: Mablagh, fldTypeSanadName: "نقدی", fldTypeSanad: 1, fldStatusFishId: "1", fldStatusFish: "صادر نشده", fldDesc: txtDesc, fldShomareHesabOrgan: txtShomareHesabPardakht_N, fldShomareHesabIdOrgan: fldShomareHesabIdPardakht_N });
                            App.Instalments.queryById('TxtMablaghNa').setValue("");
                            App.Instalments.queryById('txtDescNa').setValue("");
                            if (App.Instalments.queryById('txtShomareHesabPardakht_N').getValue() != '@ViewBag.fldShomareHesabPishfarz') {
                                App.Instalments.queryById('txtShomareHesabPardakht_N').setValue("");
                                App.Instalments.queryById('fldShomareHesabIdPardakht_N').setValue(0);
                            }
                            /*App.Instalments.queryById('Talab_NaghdiId').setValue(0);*/
                            totalDocMablagh();
                        }
                        else {
                            Ext.MessageBox.show({
                                title: "خطا",
                                msg: "جمع مبالغ وارد شده نباید بیشتر از مبلغ کل باشد.",
                                icon: Ext.MessageBox.ERROR,
                                buttons: Ext.MessageBox.OK
                            });
                        }
                    }
                    else {
                        Ext.MessageBox.show({
                            title: "خطا",
                            msg: "لطفا مبلغ را وارد کنید.",
                            icon: Ext.MessageBox.ERROR,
                            buttons: Ext.MessageBox.OK
                        });
                    }
                /*}*/
            }
            else {/*مود ویرایش*/
                if (Mablagh != 0) {
                    if (parseInt(Mablagh.replace(',', '').replace(',', '').replace(',', '').replace(',', '').replace(',', '')) <= (parseInt('@ViewBag.fldMablaghGHabelPardakht') - (sum1 - recordd.get('fldMablaghSanad')))) {
                        recordd.set('fldMablaghSanad', Mablagh);
                        recordd.set('fldDesc', txtDesc);
                        recordd.set('fldShomareHesabIdOrgan', fldShomareHesabIdPardakht_N);
                        recordd.set('fldShomareHesabOrgan', txtShomareHesabPardakht_N);
                        App.Instalments.queryById('TxtMablaghNa').setValue("");
                        App.Instalments.queryById('txtDescNa').setValue("");
                        if (App.Instalments.queryById('txtShomareHesabPardakht_N').getValue() != '@ViewBag.fldShomareHesabPishfarz') {
                            App.Instalments.queryById('txtShomareHesabPardakht_N').setValue("");
                            App.Instalments.queryById('fldShomareHesabIdPardakht_N').setValue(0);
                        }
                        recordd = null;
                        totalDocMablagh();
                    }
                    else {
                        Ext.MessageBox.show({
                            title: "خطا",
                            msg: "جمع مبالغ وارد شده نباید بیشتر از مبلغ کل باشد.",
                            icon: Ext.MessageBox.ERROR,
                            buttons: Ext.MessageBox.OK
                        });
                    }
                }
                else {
                    Ext.MessageBox.show({
                        title: "خطا",
                        msg: "لطفا مبلغ را وارد کنید.",
                        icon: Ext.MessageBox.ERROR,
                        buttons: Ext.MessageBox.OK
                    });
                }
            }
        }
        else if (field == "FieldSetTalab") {
            var store = App.Instalments.queryById('InstalmentsGrid').store;
            var sum5 = 0;
            store.each(function (rec) {
                if (rec.get('fldTypeSanad') != 6 && rec.get('fldStatus') != 5) {
                    if (rec.get('fldTypeSanad') == 7) {
                        sum5 -= rec.get('fldMablaghSanad');
                    }
                    else {
                        sum5 += rec.get('fldMablaghSanad');
                    }
                }
            });

            var Mablagh = App.Instalments.queryById('TxtMablaghTa').getValue();
            var txtDesc = App.Instalments.queryById('txtDescTa').getValue();

            if (Mablagh == 0) {
                Ext.MessageBox.show({
                    title: "خطا",
                    msg: "لطفا مبلغ را وارد کنید.",
                    icon: Ext.MessageBox.ERROR,
                    buttons: Ext.MessageBox.OK
                });
                return;
            }

            if (recordd == null) {/*مود ذخیره*/
                if (parseInt(Mablagh.replace(',', '').replace(',', '').replace(',', '').replace(',', '').replace(',', '')) <= (parseInt('@ViewBag.fldMablaghGHabelPardakht') - sum5)) {
                    App.Instalments.queryById('InstalmentsGrid').store.insert(0, { fldId: 0, fldMablaghSanad: Mablagh, fldTypeSanadName: "بدهکاری", fldTypeSanad: 5, fldDesc: txtDesc });
                    App.Instalments.queryById('TxtMablaghTa').setValue("");
                    App.Instalments.queryById('txtDescTa').setValue("");
                    /*App.Instalments.queryById('Talab_NaghdiId').setValue(0);*/
                    totalDocMablagh();
                }
                else {
                    Ext.MessageBox.show({
                        title: "خطا",
                        msg: "جمع مبالغ وارد شده نباید بیشتر از مبلغ کل باشد.",
                        icon: Ext.MessageBox.ERROR,
                        buttons: Ext.MessageBox.OK
                    });
                }
            }
            else {/*مود ویرایش*/
                if (parseInt(Mablagh.replace(',', '').replace(',', '').replace(',', '').replace(',', '').replace(',', '')) <= (parseInt('@ViewBag.fldMablaghGHabelPardakht') - (sum5 - recordd.get('fldMablaghSanad')))) {
                    recordd.set('fldMablaghSanad', Mablagh);
                    recordd.set('fldDesc', txtDesc);
                    App.Instalments.queryById('TxtMablaghTa').setValue("");
                    App.Instalments.queryById('txtDescTa').setValue("");
                    recordd = null;
                    totalDocMablagh();
                }
                else {
                    Ext.MessageBox.show({
                        title: "خطا",
                        msg: "جمع مبالغ وارد شده نباید بیشتر از مبلغ کل باشد.",
                        icon: Ext.MessageBox.ERROR,
                        buttons: Ext.MessageBox.OK
                    });
                }
            }
        }
        else if (field == "FieldSetBestankar") {
            var store = App.Instalments.queryById('InstalmentsGrid').store;
            var sum7 = 0;
            store.each(function (rec) {
                if (rec.get('fldTypeSanad') != 6 && rec.get('fldStatus') != 5) {
                    if (rec.get('fldTypeSanad') == 7) {
                        sum7 -= rec.get('fldMablaghSanad');
                    }
                    else {
                        sum7 += rec.get('fldMablaghSanad');
                    }
                }
            });

            var Mablagh = App.Instalments.queryById('TxtMablaghBes').getValue();
            var txtDesc = App.Instalments.queryById('txtDescBes').getValue();

            if (Mablagh == 0) {
                Ext.MessageBox.show({
                    title: "خطا",
                    msg: "لطفا مبلغ را وارد کنید.",
                    icon: Ext.MessageBox.ERROR,
                    buttons: Ext.MessageBox.OK
                });
                return;
            }

            if (recordd == null) {/*مود ذخیره*/
                if (parseInt(Mablagh.replace(',', '').replace(',', '').replace(',', '').replace(',', '').replace(',', '')) < parseInt('@ViewBag.fldMablaghGHabelPardakht')) {
                    App.Instalments.queryById('InstalmentsGrid').store.insert(0, { fldId: 0, fldMablaghSanad: Mablagh, fldTypeSanadName: "بستانکاری", fldTypeSanad: 7, fldDesc: txtDesc });
                    App.Instalments.queryById('TxtMablaghBes').setValue("");
                    App.Instalments.queryById('txtDescBes').setValue("");
                    /*App.Instalments.queryById('Talab_NaghdiId').setValue(0);*/
                    totalDocMablagh();
                }
                else {
                    Ext.MessageBox.show({
                        title: "خطا",
                        msg: "مبلغ بستانکاری نمی تواند بزرگتر از جمع کل باشد.",
                        icon: Ext.MessageBox.ERROR,
                        buttons: Ext.MessageBox.OK
                    });
                }
            }
            else {/*مود ویرایش*/
                if (parseInt(Mablagh.replace(',', '').replace(',', '').replace(',', '').replace(',', '').replace(',', '')) < parseInt('@ViewBag.fldMablaghGHabelPardakht')) {
                    recordd.set('fldMablaghSanad', Mablagh);
                    recordd.set('fldDesc', txtDesc);
                    App.Instalments.queryById('TxtMablaghBes').setValue("");
                    App.Instalments.queryById('txtDescBes').setValue("");
                    recordd = null;
                    totalDocMablagh();
                }
                else {
                    Ext.MessageBox.show({
                        title: "خطا",
                        msg: "مبلغ بستانکاری نمی تواند بزرگتر از جمع کل باشد.",
                        icon: Ext.MessageBox.ERROR,
                        buttons: Ext.MessageBox.OK
                    });
                }
            }
        }
        else if (field == "FieldSetSafteh") {
            var store = App.Instalments.queryById('InstalmentsGrid').store;
            var sum2 = 0;
            store.each(function (rec) {
                if (rec.get('fldTypeSanad') != 6 && rec.get('fldStatus') != 5) {
                    if (rec.get('fldTypeSanad') == 7) {
                        sum2 -= rec.get('fldMablaghSanad');
                    }
                    else {
                        sum2 += rec.get('fldMablaghSanad');
                    }
                }
            });

            var txtTarikhSarResid = App.Instalments.queryById('txtTarikhSarResidS').getRawValue();
            var txtTarikhStatusS = App.Instalments.queryById('txtTarikhStatusS').getRawValue();
            var txtShomareSanad = App.Instalments.queryById('txtShomareSanadS').getValue();
            var TxtMablaghSanad = App.Instalments.queryById('TxtMablaghSanadS').getValue();
            var Status = App.Instalments.queryById('CboStatusS').getDisplayValue();
            var txtDesc = App.Instalments.queryById('txtDescS').getValue();
            var Exist = false;

            var er = false;
            if (App.Instalments.queryById('txtTarikhSarResidS').validate() == false) {
                er = true;
            }
            if (App.Instalments.queryById('txtTarikhStatusS').validate() == false) {
                er = true;
            }
            if (App.Instalments.queryById('txtShomareSanadS').validate() == false) {
                er = true;
            }
            if (App.Instalments.queryById('TxtMablaghSanadS').validate() == false) {
                er = true;
            }
            if (App.Instalments.queryById('CboStatusS').validate() == false) {
                er = true;
            }
            if (er == true) {
                return;
            }

            if (App.Instalments.queryById('TxtMablaghSanadS').getValue() == 0) {
                Ext.MessageBox.show({
                    title: "خطا",
                    msg: "لطفا مبلغ را وارد کنید.",
                    icon: Ext.MessageBox.ERROR,
                    buttons: Ext.MessageBox.OK
                });
                return;
            }

            if (recordd == null) {/*ذخیره*/
                if (parseInt(TxtMablaghSanad.replace(',', '').replace(',', '').replace(',', '').replace(',', '').replace(',', '')) <= (parseInt('@ViewBag.fldMablaghGHabelPardakht') - sum2) || App.Instalments.queryById('CboStatusS').getValue() == "5") {
                if (App.Instalments.queryById('CboStatusS').getValue() != "1") {
                    Ext.MessageBox.show({
                        title: "هشدار",
                        msg: "آیااز انتخاب مقدار فیلد وضعیت مطمئن هستید؟ در صورت ذخیره امکان ویرایش وجود ندارد.",
                        icon: Ext.MessageBox.WARNING,
                        buttons: Ext.MessageBox.YESNO,
                        fn: function (btn) {
                            if (btn == "yes") {
                                App.Instalments.queryById('InstalmentsGrid').getStore().each(function (record) {
                                    if (record.data.fldTypeSanad == 3 && record.data.fldShomareSanad == txtShomareSanad) {
                                        Exist = true;
                                    }
                                });

                                if (Exist == true) {
                                    Ext.MessageBox.show({
                                        title: "خطا",
                                        msg: "شماره سند وارد شده تکراری است.",
                                        icon: Ext.MessageBox.ERROR,
                                        buttons: Ext.MessageBox.OK
                                    });
                                }
                                else {
                                    App.Instalments.queryById('InstalmentsGrid').store.insert(0, {
                                        fldId: 0, fldTarikhSarResid: txtTarikhSarResid, fldShomareSanad: txtShomareSanad, fldMablaghSanad: TxtMablaghSanad, fldStatusName: Status, fldStatus: App.Instalments.queryById('CboStatusS').getValue(),
                                        fldTypeSanadName: "سفته", fldTypeSanad: 3, fldDesc: txtDesc, fldDateSatus: txtTarikhStatusS
                                    });
                                    App.Instalments.queryById('TxtMablaghSanadS').setValue("");
                                    App.Instalments.queryById('txtShomareSanadS').setValue("");
                                    App.Instalments.queryById('txtTarikhSarResidS').setValue("");
                                    App.Instalments.queryById('txtTarikhStatusS').setValue("");
                                    App.Instalments.queryById('txtDescS').setValue("");
                                    App.Instalments.queryById('CboStatusS').setValue("1");
                                    totalDocMablagh();
                                }
                            }
                        }
                    });
                }
                else {
                    App.Instalments.queryById('InstalmentsGrid').getStore().each(function (record) {
                        if (record.data.fldTypeSanad == 3 && record.data.fldShomareSanad == txtShomareSanad) {
                            Exist = true;
                        }
                    });

                    if (Exist == true) {
                        Ext.MessageBox.show({
                            title: "خطا",
                            msg: "شماره سند وارد شده تکراری است.",
                            icon: Ext.MessageBox.ERROR,
                            buttons: Ext.MessageBox.OK
                        });
                    }
                    else {
                        App.Instalments.queryById('InstalmentsGrid').store.insert(0, {
                            fldId: 0, fldTarikhSarResid: txtTarikhSarResid, fldShomareSanad: txtShomareSanad, fldMablaghSanad: TxtMablaghSanad, fldStatusName: Status, fldStatus: App.Instalments.queryById('CboStatusS').getValue(),
                            fldTypeSanadName: "سفته", fldTypeSanad: 3, fldDesc: txtDesc, fldDateStatus: txtTarikhStatusS
                        });
                        App.Instalments.queryById('TxtMablaghSanadS').setValue("");
                        App.Instalments.queryById('txtShomareSanadS').setValue("");
                        App.Instalments.queryById('txtTarikhSarResidS').setValue("");
                        App.Instalments.queryById('txtTarikhStatusS').setValue("");
                        App.Instalments.queryById('txtDescS').setValue("");
                        App.Instalments.queryById('CboStatusS').setValue("1");
                        totalDocMablagh();
                    }
                }
            }
            else {
                Ext.MessageBox.show({
                    title: "خطا",
                    msg: "جمع مبالغ وارد شده نباید بیشتر از مبلغ کل باشد.",
                    icon: Ext.MessageBox.ERROR,
                    buttons: Ext.MessageBox.OK
                });
            }
        }
        else {/*ویرایش*/
            if (parseInt(TxtMablaghSanad.replace(',', '').replace(',', '').replace(',', '').replace(',', '').replace(',', '')) <= (parseInt('@ViewBag.fldMablaghGHabelPardakht') - (sum2 - recordd.get('fldMablaghSanad'))) || App.Instalments.queryById('CboStatusS').getValue() == "5") {
                if (App.Instalments.queryById('CboStatusS').getValue() != "1") {
                    Ext.MessageBox.show({
                        title: "هشدار",
                        msg: "آیااز انتخاب مقدار فیلد وضعیت مطمئن هستید؟ در صورت ذخیره امکان ویرایش وجود ندارد.",
                        icon: Ext.MessageBox.WARNING,
                        buttons: Ext.MessageBox.YESNO,
                        fn: function (btn) {
                            if (btn == "yes") {
                                App.Instalments.queryById('InstalmentsGrid').getStore().each(function (record) {
                                    if (record.data.fldTypeSanad == 3 && record.data.fldShomareSanad == txtShomareSanad && record.data.fldShomareSanad != recordd.data.fldShomareSanad) {
                                        Exist = true;
                                    }
                                });

                                if (Exist == true) {
                                    Ext.MessageBox.show({
                                        title: "خطا",
                                        msg: "شماره سند وارد شده تکراری است.",
                                        icon: Ext.MessageBox.ERROR,
                                        buttons: Ext.MessageBox.OK
                                    });
                                }
                                else {
                                    recordd.set('fldTarikhSarResid', txtTarikhSarResid);
                                    recordd.set('fldDateStatus', txtTarikhStatusS);
                                    recordd.set('fldShomareSanad', txtShomareSanad);
                                    recordd.set('fldMablaghSanad', TxtMablaghSanad);
                                    recordd.set('fldStatusName', Status);
                                    recordd.set('fldStatus', App.Instalments.queryById('CboStatusS').getValue());
                                    recordd.set('fldDesc', txtDesc);
                                    App.Instalments.queryById('TxtMablaghSanadS').setValue("");
                                    App.Instalments.queryById('txtShomareSanadS').setValue("");
                                    App.Instalments.queryById('txtTarikhSarResidS').setValue("");
                                    App.Instalments.queryById('txtTarikhStatusS').setValue("");
                                    App.Instalments.queryById('txtDescS').setValue("");
                                    App.Instalments.queryById('CboStatusS').setValue("1");
                                    recordd = null;
                                    totalDocMablagh();
                                }
                            }
                        }
                    });
                }
                else {
                    App.Instalments.queryById('InstalmentsGrid').getStore().each(function (record) {
                        if (record.data.fldTypeSanad == 3 && record.data.fldShomareSanad == txtShomareSanad && record.data.fldShomareSanad != recordd.data.fldShomareSanad) {
                            Exist = true;
                        }
                    });

                    if (Exist == true) {
                        Ext.MessageBox.show({
                            title: "خطا",
                            msg: "شماره سند وارد شده تکراری است.",
                            icon: Ext.MessageBox.ERROR,
                            buttons: Ext.MessageBox.OK
                        });
                    }
                    else {
                        recordd.set('fldTarikhSarResid', txtTarikhSarResid);
                        recordd.set('fldDateStatus', txtTarikhStatusS);
                        recordd.set('fldShomareSanad', txtShomareSanad);
                        recordd.set('fldMablaghSanad', TxtMablaghSanad);
                        recordd.set('fldStatusName', Status);
                        recordd.set('fldStatus', App.Instalments.queryById('CboStatusS').getValue());
                        recordd.set('fldDesc', txtDesc);
                        App.Instalments.queryById('TxtMablaghSanadS').setValue("");
                        App.Instalments.queryById('txtShomareSanadS').setValue("");
                        App.Instalments.queryById('txtTarikhSarResidS').setValue("");
                        App.Instalments.queryById('txtTarikhStatusS').setValue("");
                        App.Instalments.queryById('txtDescS').setValue("");
                        App.Instalments.queryById('CboStatusS').setValue("1");
                        recordd = null;
                        totalDocMablagh();
                    }
                }
            }
            else {
                Ext.MessageBox.show({
                    title: "خطا",
                    msg: "جمع مبالغ وارد شده نباید بیشتر از مبلغ کل باشد.",
                    icon: Ext.MessageBox.ERROR,
                    buttons: Ext.MessageBox.OK
                });
            }
        }
    }
    else if (field == "FieldSetBarat") {

        var store = App.Instalments.queryById('InstalmentsGrid').store;
        var sum3 = 0;
        store.each(function (rec) {
            if (rec.get('fldTypeSanad') != 6 && rec.get('fldStatus') != 5) {
                if (rec.get('fldTypeSanad') == 7) {
                    sum3 -= rec.get('fldMablaghSanad');
                }
                else {
                    sum3 += rec.get('fldMablaghSanad');
                }
            }
        });

        var txtTarikhSarResid = App.Instalments.queryById('txtTarikhSarResidB').getRawValue();
        var txtTarikhStatusB = App.Instalments.queryById('txtTarikhStatusB').getRawValue();
        var txtShomareSanad = App.Instalments.queryById('txtShomareSanadB').getValue();
        var TxtMablaghSanad = App.Instalments.queryById('TxtMablaghSanadB').getValue();
        var BaratDar = App.Instalments.queryById('txtBaratDar').getValue();
        var BaratDarId = App.Instalments.queryById('fldBaratDarId').getValue();
        var MakanPardakht = App.Instalments.queryById('txtMakanPardakhtB').getValue();
        var Status = App.Instalments.queryById('CboStatusB').getDisplayValue();
        var txtDesc = App.Instalments.queryById('txtDescB').getValue();
        var Exist = false;

        var er = false;
        if (App.Instalments.queryById('txtTarikhSarResidB').validate() == false) {
            er = true;
        }
        if (App.Instalments.queryById('txtTarikhStatusB').validate() == false) {
            er = true;
        }
        if (App.Instalments.queryById('txtShomareSanadB').validate() == false) {
            er = true;
        }
        if (App.Instalments.queryById('TxtMablaghSanadB').validate() == false) {
            er = true;
        }
        if (App.Instalments.queryById('txtBaratDar').validate() == false) {
            er = true;
        }
        if (App.Instalments.queryById('fldBaratDarId').getValue() == 0) {
            er = true;
        }
        if (App.Instalments.queryById('txtMakanPardakhtB').validate() == false) {
            er = true;
        } if (App.Instalments.queryById('CboStatusB').validate() == false) {
            er = true;
        }
        if (er == true) {
            return;
        }

        if (App.Instalments.queryById('TxtMablaghSanadB').getValue() == 0) {
            Ext.MessageBox.show({
                title: "خطا",
                msg: "لطفا مبلغ را وارد کنید.",
                icon: Ext.MessageBox.ERROR,
                buttons: Ext.MessageBox.OK
            });
            return;
        }

        if (recordd == null) {/*ذخیره*/
            if (parseInt(TxtMablaghSanad.replace(',', '').replace(',', '').replace(',', '').replace(',', '').replace(',', '')) <= (parseInt('@ViewBag.fldMablaghGHabelPardakht') - sum3) || App.Instalments.queryById('CboStatusB').getValue() == "5") {
                if (App.Instalments.queryById('CboStatusB').getValue() != "1") {
                    Ext.MessageBox.show({
                        title: "هشدار",
                        msg: "آیااز انتخاب مقدار فیلد وضعیت مطمئن هستید؟ در صورت ذخیره امکان ویرایش وجود ندارد.",
                        icon: Ext.MessageBox.WARNING,
                        buttons: Ext.MessageBox.YESNO,
                        fn: function (btn) {
                            if (btn == "yes") {
                                App.Instalments.queryById('InstalmentsGrid').getStore().each(function (record) {
                                    if (record.data.fldTypeSanad == 4 && record.data.fldShomareSanad == txtShomareSanad) {
                                        Exist = true;
                                    }
                                });
                                if (Exist == true) {
                                    Ext.MessageBox.show({
                                        title: "خطا",
                                        msg: "شماره سند وارد شده تکراری است.",
                                        icon: Ext.MessageBox.ERROR,
                                        buttons: Ext.MessageBox.OK
                                    });
                                }
                                else {
                                    App.Instalments.queryById('InstalmentsGrid').store.insert(0, {
                                        fldId: 0, fldTarikhSarResid: txtTarikhSarResid, fldShomareSanad: txtShomareSanad, fldMablaghSanad: TxtMablaghSanad,
                                        fldStatusName: Status, fldStatus: App.Instalments.queryById('CboStatusB').getValue(), fldMakanPardakht: MakanPardakht,
                                        fldNameBaratDar: BaratDar, fldBaratDarId: BaratDarId, fldTypeSanadName: "برات", fldTypeSanad: 4, fldDesc: txtDesc,
                                        fldDateStatus: txtTarikhStatusB
                                    });
                                    App.Instalments.queryById('TxtMablaghSanadB').setValue("");
                                    App.Instalments.queryById('txtShomareSanadB').setValue("");
                                    App.Instalments.queryById('txtMakanPardakhtB').setValue("");
                                    App.Instalments.queryById('txtBaratDar').setValue("");
                                    App.Instalments.queryById('fldBaratDarId').setValue(0);
                                    App.Instalments.queryById('txtTarikhSarResidB').setValue("");
                                    App.Instalments.queryById('txtTarikhStatusB').setValue("");
                                    App.Instalments.queryById('txtDescB').setValue("");
                                    App.Instalments.queryById('CboStatusB').setValue("1");
                                    totalDocMablagh();
                                }
                            }
                        }
                    });
                }
                else {
                    App.Instalments.queryById('InstalmentsGrid').getStore().each(function (record) {
                        if (record.data.fldTypeSanad == 4 && record.data.fldShomareSanad == txtShomareSanad) {
                            Exist = true;
                        }
                    });
                    if (Exist == true) {
                        Ext.MessageBox.show({
                            title: "خطا",
                            msg: "شماره سند وارد شده تکراری است.",
                            icon: Ext.MessageBox.ERROR,
                            buttons: Ext.MessageBox.OK
                        });
                    }
                    else {
                        App.Instalments.queryById('InstalmentsGrid').store.insert(0, {
                            fldId: 0, fldTarikhSarResid: txtTarikhSarResid, fldShomareSanad: txtShomareSanad, fldMablaghSanad: TxtMablaghSanad,
                            fldStatusName: Status, fldStatus: App.Instalments.queryById('CboStatusB').getValue(), fldMakanPardakht: MakanPardakht,
                            fldNameBaratDar: BaratDar, fldBaratDarId: BaratDarId, fldTypeSanadName: "برات", fldTypeSanad: 4, fldDesc: txtDesc,
                            fldDateStatus: txtTarikhStatusB
                        });
                        App.Instalments.queryById('TxtMablaghSanadB').setValue("");
                        App.Instalments.queryById('txtShomareSanadB').setValue("");
                        App.Instalments.queryById('txtMakanPardakhtB').setValue("");
                        App.Instalments.queryById('txtBaratDar').setValue("");
                        App.Instalments.queryById('fldBaratDarId').setValue(0);
                        App.Instalments.queryById('txtTarikhSarResidB').setValue("");
                        App.Instalments.queryById('txtTarikhStatusB').setValue("");
                        App.Instalments.queryById('txtDescB').setValue("");
                        App.Instalments.queryById('CboStatusB').setValue("1");
                        totalDocMablagh();
                    }
                }
            }
            else {
                Ext.MessageBox.show({
                    title: "خطا",
                    msg: "جمع مبالغ وارد شده نباید بیشتر از مبلغ کل باشد.",
                    icon: Ext.MessageBox.ERROR,
                    buttons: Ext.MessageBox.OK
                });
            }
        }
        else {/*ویرایش*/
            if (parseInt(TxtMablaghSanad.replace(',', '').replace(',', '').replace(',', '').replace(',', '').replace(',', '')) <= (parseInt('@ViewBag.fldMablaghGHabelPardakht') - (sum3 - recordd.get('fldMablaghSanad'))) || App.Instalments.queryById('CboStatusB').getValue() == "5") {
                if (App.Instalments.queryById('CboStatusB').getValue() != "1") {
                    Ext.MessageBox.show({
                        title: "هشدار",
                        msg: "آیااز انتخاب مقدار فیلد وضعیت مطمئن هستید؟ در صورت ذخیره امکان ویرایش وجود ندارد.",
                        icon: Ext.MessageBox.WARNING,
                        buttons: Ext.MessageBox.YESNO,
                        fn: function (btn) {
                            if (btn == "yes") {
                                App.Instalments.queryById('InstalmentsGrid').getStore().each(function (record) {
                                    if (record.data.fldTypeSanad == 4 && record.data.fldShomareSanad == txtShomareSanad && record.data.fldShomareSanad != recordd.data.fldShomareSanad) {
                                        Exist = true;
                                    }
                                });
                                if (Exist == true) {
                                    Ext.MessageBox.show({
                                        title: "خطا",
                                        msg: "شماره سند وارد شده تکراری است.",
                                        icon: Ext.MessageBox.ERROR,
                                        buttons: Ext.MessageBox.OK
                                    });
                                }
                                else {
                                    recordd.set('fldTarikhSarResid', txtTarikhSarResid);
                                    recordd.set('fldDateStatus', txtTarikhStatusB);
                                    recordd.set('fldShomareSanad', txtShomareSanad);
                                    recordd.set('fldMablaghSanad', TxtMablaghSanad);
                                    recordd.set('fldNameBaratDar', BaratDar);
                                    recordd.set('fldBaratDarId', BaratDarId);
                                    recordd.set('fldMakanPardakht', MakanPardakht);
                                    recordd.set('fldStatusName', Status);
                                    recordd.set('fldStatus', App.Instalments.queryById('CboStatusB').getValue());
                                    recordd.set('fldDesc', txtDesc);
                                    App.Instalments.queryById('txtTarikhSarResidB').setValue("");
                                    App.Instalments.queryById('txtTarikhStatusB').setValue("");
                                    App.Instalments.queryById('TxtMablaghSanadB').setValue("");
                                    App.Instalments.queryById('txtShomareSanadB').setValue("");
                                    App.Instalments.queryById('txtMakanPardakhtB').setValue("");
                                    App.Instalments.queryById('txtBaratDar').setValue("");
                                    App.Instalments.queryById('fldBaratDarId').setValue(0);
                                    App.Instalments.queryById('txtDescB').setValue("");
                                    App.Instalments.queryById('CboStatusB').setValue("1");
                                    recordd = null;
                                    totalDocMablagh();
                                }
                            }
                        }
                    });
                }
                else {
                    App.Instalments.queryById('InstalmentsGrid').getStore().each(function (record) {
                        if (record.data.fldTypeSanad == 4 && record.data.fldShomareSanad == txtShomareSanad && record.data.fldShomareSanad != recordd.data.fldShomareSanad) {
                            Exist = true;
                        }
                    });
                    if (Exist == true) {
                        Ext.MessageBox.show({
                            title: "خطا",
                            msg: "شماره سند وارد شده تکراری است.",
                            icon: Ext.MessageBox.ERROR,
                            buttons: Ext.MessageBox.OK
                        });
                    }
                    else {
                        recordd.set('fldTarikhSarResid', txtTarikhSarResid);
                        recordd.set('fldDateStatus', txtTarikhStatusB);
                        recordd.set('fldShomareSanad', txtShomareSanad);
                        recordd.set('fldMablaghSanad', TxtMablaghSanad);
                        recordd.set('fldNameBaratDar', BaratDar);
                        recordd.set('fldBaratDarId', BaratDarId);
                        recordd.set('fldMakanPardakht', MakanPardakht);
                        recordd.set('fldStatusName', Status);
                        recordd.set('fldStatus', App.Instalments.queryById('CboStatusB').getValue());
                        recordd.set('fldDesc', txtDesc);
                        App.Instalments.queryById('txtTarikhSarResidB').setValue("");
                        App.Instalments.queryById('txtTarikhStatusB').setValue("");
                        App.Instalments.queryById('TxtMablaghSanadB').setValue("");
                        App.Instalments.queryById('txtShomareSanadB').setValue("");
                        App.Instalments.queryById('txtMakanPardakhtB').setValue("");
                        App.Instalments.queryById('txtBaratDar').setValue("");
                        App.Instalments.queryById('fldBaratDarId').setValue(0);
                        App.Instalments.queryById('txtDescB').setValue("");
                        App.Instalments.queryById('CboStatusB').setValue("1");
                        recordd = null;
                        totalDocMablagh();
                    }
                }
            }
            else {
                Ext.MessageBox.show({
                    title: "خطا",
                    msg: "جمع مبالغ وارد شده نباید بیشتر از مبلغ کل باشد.",
                    icon: Ext.MessageBox.ERROR,
                    buttons: Ext.MessageBox.OK
                });
            }
        }
    }
    else if (field == "FieldSetCheck") {

        var store = App.Instalments.queryById('InstalmentsGrid').store;
        var sum4 = 0;
        store.each(function (rec) {
            if (rec.get('fldTypeSanad') != 6 && rec.get('fldStatus') != 5) {
                if (rec.get('fldTypeSanad') == 7) {
                    sum4 -= rec.get('fldMablaghSanad');
                }
                else {
                    sum4 += rec.get('fldMablaghSanad');
                }
            }
        });

        var txtTarikhSarResid = App.Instalments.queryById('txtTarikhSarResidCh').getRawValue();
        var txtTarikhStatusCh = App.Instalments.queryById('txtTarikhStatusCh').getRawValue();
        var txtShomareSanad = App.Instalments.queryById('txtShomareSanadCh').getValue();
        var TxtMablaghSanad = App.Instalments.queryById('TxtMablaghSanadCh').getValue();
        var txtShomareHesab = App.Instalments.queryById('txtShomareHesab').getValue();
        var ShomareHesabId = App.Instalments.queryById('fldShomareHesabId').getValue();
        var txtShomareHesabPardakht = App.Instalments.queryById('txtShomareHesabPardakht').getValue();
        var fldShomareHesabIdPardakht = App.Instalments.queryById('fldShomareHesabIdPardakht').getValue();
        var Status = App.Instalments.queryById('CboStatusCh').getDisplayValue();
        var TypeSanad = App.Instalments.queryById('CboTypeSanadCh').getValue();
        var txtBank = App.Instalments.queryById('txtBank').getValue();
        var txtShobe = App.Instalments.queryById('txtShobe').getValue();
        var txtDesc = App.Instalments.queryById('txtDescCh').getValue();

        if (TypeSanad == 1) {
            typeCheck = 6;
            typeCheckName = "چک ضمانتی";
        }
        else {
            typeCheckName = "چک عادی";
            typeCheck = 2;
        }
        var Exist = false;

        var er = false;
        if (App.Instalments.queryById('txtTarikhSarResidCh').validate() == false) {
            er = true;
        }
        if (App.Instalments.queryById('txtTarikhStatusCh').validate() == false) {
            er = true;
        }
        if (App.Instalments.queryById('txtShomareSanadCh').validate() == false) {
            er = true;
        }
        if (App.Instalments.queryById('TxtMablaghSanadCh').validate() == false) {
            er = true;
        }
        if (App.Instalments.queryById('txtShomareHesab').validate() == false) {
            er = true;
        }
        if (App.Instalments.queryById('txtShomareHesabPardakht').validate() == false) {
            er = true;
        }
        if (App.Instalments.queryById('fldShomareHesabId').getValue() == 0) {
            er = true;
        }
        if (App.Instalments.queryById('CboStatusCh').validate() == false) {
            er = true;
        }
        if (App.Instalments.queryById('CboTypeSanadCh').validate() == false) {
            er = true;
        }
        if (er == true) {
            return;
        }
        if (App.Instalments.queryById('TxtMablaghSanadCh').getValue() == 0) {
            Ext.MessageBox.show({
                title: "خطا",
                msg: "لطفا مبلغ را وارد کنید.",
                icon: Ext.MessageBox.ERROR,
                buttons: Ext.MessageBox.OK
            });
            return;
        }

        if (recordd == null) {/*ذخیره*/
            if (parseInt(TxtMablaghSanad.replace(',', '').replace(',', '').replace(',', '').replace(',', '').replace(',', '')) <= (parseInt('@ViewBag.fldMablaghGHabelPardakht') - sum4) || App.Instalments.queryById('CboStatusCh').getValue() == "5" || App.Instalments.queryById('CboTypeSanadCh').getValue() == "1") {
                if (App.Instalments.queryById('CboStatusCh').getValue() != "1") {
                    Ext.MessageBox.show({
                        title: "هشدار",
                        msg: "آیااز انتخاب مقدار فیلد وضعیت مطمئن هستید؟ در صورت ذخیره امکان ویرایش وجود ندارد.",
                        icon: Ext.MessageBox.WARNING,
                        buttons: Ext.MessageBox.YESNO,
                        fn: function (btn) {
                            if (btn == "yes") {
                                App.Instalments.queryById('InstalmentsGrid').getStore().each(function (record) {
                                    if ((record.data.fldTypeSanad == 6 || record.data.fldTypeSanad == 2) && record.data.fldShomareSanad == txtShomareSanad) {
                                        Exist = true;
                                    }
                                });
                                if (Exist == true) {
                                    Ext.MessageBox.show({
                                        title: "خطا",
                                        msg: "شماره سند وارد شده تکراری است.",
                                        icon: Ext.MessageBox.ERROR,
                                        buttons: Ext.MessageBox.OK
                                    });
                                }
                                else {
                                    App.Instalments.queryById('InstalmentsGrid').store.insert(0, {
                                        fldId: 0, fldTarikhSarResid: txtTarikhSarResid, fldShomareSanad: txtShomareSanad, fldMablaghSanad: TxtMablaghSanad,
                                        fldShomareHesab: txtShomareHesab, fldShomareHesabId: ShomareHesabId, fldShomareHesabOrgan: txtShomareHesabPardakht, fldShomareHesabIdOrgan:fldShomareHesabIdPardakht,fldStatusName: Status, fldStatus: App.Instalments.queryById('CboStatusCh').getValue(), fldTypeSanadName: typeCheckName, fldTypeSanad: typeCheck,
                                        fldNameShobe: txtShobe, fldBankName: txtBank, fldDesc: txtDesc, fldDateStatus: txtTarikhStatusCh
                                    });
                                    App.Instalments.queryById('txtTarikhSarResidCh').setValue("");
                                    App.Instalments.queryById('txtTarikhStatusCh').setValue("");
                                    App.Instalments.queryById('txtShomareSanadCh').setValue("");
                                    App.Instalments.queryById('TxtMablaghSanadCh').setValue("");
                                    App.Instalments.queryById('txtShomareHesab').setValue("");
                                    App.Instalments.queryById('fldShomareHesabId').setValue(0);
                                    if (App.Instalments.queryById('txtShomareHesabPardakht').getValue() != '@ViewBag.fldShomareHesabPishfarz') {
                                        App.Instalments.queryById('txtShomareHesabPardakht').setValue("");
                                        App.Instalments.queryById('fldShomareHesabIdPardakht').setValue(0);
                                    }
                                    App.Instalments.queryById('txtBank').setValue("");
                                    App.Instalments.queryById('txtShobe').setValue("");
                                    App.Instalments.queryById('txtDescCh').setValue("");
                                    App.Instalments.queryById('CboStatusCh').setValue("1");
                                    totalDocMablagh();
                                }
                            }
                        }
                    });
                }
                else {
                    App.Instalments.queryById('InstalmentsGrid').getStore().each(function (record) {
                        if ((record.data.fldTypeSanad == 6 || record.data.fldTypeSanad == 2) && record.data.fldShomareSanad == txtShomareSanad) {
                            Exist = true;
                        }
                    });
                    if (Exist == true) {
                        Ext.MessageBox.show({
                            title: "خطا",
                            msg: "شماره سند وارد شده تکراری است.",
                            icon: Ext.MessageBox.ERROR,
                            buttons: Ext.MessageBox.OK
                        });
                    }
                    else {
                        App.Instalments.queryById('InstalmentsGrid').store.insert(0, {
                            fldId: 0, fldTarikhSarResid: txtTarikhSarResid, fldShomareSanad: txtShomareSanad, fldMablaghSanad: TxtMablaghSanad,
                            fldShomareHesab: txtShomareHesab, fldShomareHesabId: ShomareHesabId,fldShomareHesabOrgan: txtShomareHesabPardakht, fldShomareHesabIdOrgan:fldShomareHesabIdPardakht, fldStatusName: Status, fldStatus: App.Instalments.queryById('CboStatusCh').getValue(), fldTypeSanadName: typeCheckName, fldTypeSanad: typeCheck,
                            fldNameShobe: txtShobe, fldBankName: txtBank, fldDesc: txtDesc, fldDateStatus: txtTarikhStatusCh
                        });
                        App.Instalments.queryById('txtTarikhSarResidCh').setValue("");
                        App.Instalments.queryById('txtTarikhStatusCh').setValue("");
                        App.Instalments.queryById('txtShomareSanadCh').setValue("");
                        App.Instalments.queryById('TxtMablaghSanadCh').setValue("");
                        App.Instalments.queryById('txtShomareHesab').setValue("");
                        App.Instalments.queryById('fldShomareHesabId').setValue(0);
                        if (App.Instalments.queryById('txtShomareHesabPardakht').getValue() != '@ViewBag.fldShomareHesabPishfarz') {
                            App.Instalments.queryById('txtShomareHesabPardakht').setValue("");
                            App.Instalments.queryById('fldShomareHesabIdPardakht').setValue(0);
                        }
                        App.Instalments.queryById('txtBank').setValue("");
                        App.Instalments.queryById('txtShobe').setValue("");
                        App.Instalments.queryById('txtDescCh').setValue("");
                        App.Instalments.queryById('CboStatusCh').setValue("1");
                        totalDocMablagh();
                    }
                }
            }
            else {
                Ext.MessageBox.show({
                    title: "خطا",
                    msg: "جمع مبالغ وارد شده نباید بیشتر از مبلغ کل باشد.",
                    icon: Ext.MessageBox.ERROR,
                    buttons: Ext.MessageBox.OK
                });
            }
        }
        else {/*ویرایش*/
            if (parseInt(TxtMablaghSanad.replace(',', '').replace(',', '').replace(',', '').replace(',', '').replace(',', '')) <= (parseInt('@ViewBag.fldMablaghGHabelPardakht') - (sum4 - recordd.get('fldMablaghSanad'))) || App.Instalments.queryById('CboStatusCh').getValue() == "5" || App.Instalments.queryById('CboTypeSanadCh').getValue() == "1") {
                if (App.Instalments.queryById('CboStatusCh').getValue() != "1") {
                    Ext.MessageBox.show({
                        title: "هشدار",
                        msg: "آیااز انتخاب مقدار فیلد وضعیت مطمئن هستید؟ در صورت ذخیره امکان ویرایش وجود ندارد.",
                        icon: Ext.MessageBox.WARNING,
                        buttons: Ext.MessageBox.YESNO,
                        fn: function (btn) {
                            if (btn == "yes") {
                                App.Instalments.queryById('InstalmentsGrid').getStore().each(function (record) {
                                    if ((record.data.fldTypeSanad == 6 || record.data.fldTypeSanad == 2) && record.data.fldShomareSanad == txtShomareSanad && record.data.fldShomareSanad != recordd.data.fldShomareSanad) {
                                        Exist = true;
                                    }
                                });
                                if (Exist == true) {
                                    Ext.MessageBox.show({
                                        title: "خطا",
                                        msg: "شماره سند وارد شده تکراری است.",
                                        icon: Ext.MessageBox.ERROR,
                                        buttons: Ext.MessageBox.OK
                                    });
                                }
                                else {
                                    recordd.set('fldTarikhSarResid', txtTarikhSarResid);
                                    recordd.set('fldDateStatus', txtTarikhStatusCh);
                                    recordd.set('fldShomareSanad', txtShomareSanad);
                                    recordd.set('fldMablaghSanad', TxtMablaghSanad);
                                    recordd.set('fldShomareHesab', txtShomareHesab);
                                    recordd.set('fldShomareHesabId', ShomareHesabId);
                                    recordd.set('fldShomareHesabOrgan', txtShomareHesabPardakht);
                                    recordd.set('fldShomareHesabIdOrgan', fldShomareHesabIdPardakht);
                                    recordd.set('fldNameShobe', txtShobe);
                                    recordd.set('fldBankName', txtBank);
                                    recordd.set('fldStatusName', Status);
                                    recordd.set('fldStatus', App.Instalments.queryById('CboStatusCh').getValue());
                                    recordd.set('fldDesc', txtDesc);
                                    recordd.set('fldTypeSanad', String(typeCheck));

                                    App.Instalments.queryById('txtTarikhSarResidCh').setValue("");
                                    App.Instalments.queryById('txtTarikhStatusCh').setValue("");
                                    App.Instalments.queryById('txtShomareSanadCh').setValue("");
                                    App.Instalments.queryById('TxtMablaghSanadCh').setValue("");
                                    App.Instalments.queryById('txtShomareHesab').setValue("");
                                    App.Instalments.queryById('fldShomareHesabId').setValue(0);
                                    if (App.Instalments.queryById('txtShomareHesabPardakht').getValue() != '@ViewBag.fldShomareHesabPishfarz') {
                                        App.Instalments.queryById('txtShomareHesabPardakht').setValue("");
                                        App.Instalments.queryById('fldShomareHesabIdPardakht').setValue(0);
                                    }
                                    App.Instalments.queryById('txtBank').setValue("");
                                    App.Instalments.queryById('txtShobe').setValue("");
                                    App.Instalments.queryById('txtDescCh').setValue("");
                                    App.Instalments.queryById('CboStatusCh').setValue("1");
                                    recordd = null;
                                    totalDocMablagh();
                                }
                            }
                        }
                    });
                }
                else {
                    App.Instalments.queryById('InstalmentsGrid').getStore().each(function (record) {
                        if ((record.data.fldTypeSanad == 6 || record.data.fldTypeSanad == 2) && record.data.fldShomareSanad == txtShomareSanad && record.data.fldShomareSanad != recordd.data.fldShomareSanad) {
                            Exist = true;
                        }
                    });
                    if (Exist == true) {
                        Ext.MessageBox.show({
                            title: "خطا",
                            msg: "شماره سند وارد شده تکراری است.",
                            icon: Ext.MessageBox.ERROR,
                            buttons: Ext.MessageBox.OK
                        });
                    }
                    else {
                        recordd.set('fldTarikhSarResid', txtTarikhSarResid);
                        recordd.set('fldDateStatus', txtTarikhStatusCh);
                        recordd.set('fldShomareSanad', txtShomareSanad);
                        recordd.set('fldMablaghSanad', TxtMablaghSanad);
                        recordd.set('fldShomareHesab', txtShomareHesab);
                        recordd.set('fldShomareHesabId', ShomareHesabId);
                        recordd.set('fldShomareHesabOrgan', txtShomareHesabPardakht);
                        recordd.set('fldShomareHesabIdOrgan', fldShomareHesabIdPardakht);
                        recordd.set('fldNameShobe', txtShobe);
                        recordd.set('fldBankName', txtBank);
                        recordd.set('fldStatusName', Status);
                        recordd.set('fldStatus', App.Instalments.queryById('CboStatusCh').getValue());
                        recordd.set('fldDesc', txtDesc);
                        recordd.set('fldTypeSanad', String(typeCheck));

                        App.Instalments.queryById('txtTarikhSarResidCh').setValue("");
                        App.Instalments.queryById('txtTarikhStatusCh').setValue("");
                        App.Instalments.queryById('txtShomareSanadCh').setValue("");
                        App.Instalments.queryById('TxtMablaghSanadCh').setValue("");
                        App.Instalments.queryById('txtShomareHesab').setValue("");
                        App.Instalments.queryById('fldShomareHesabId').setValue(0);
                        if (App.Instalments.queryById('txtShomareHesabPardakht').getValue() != '@ViewBag.fldShomareHesabPishfarz') {
                            App.Instalments.queryById('txtShomareHesabPardakht').setValue("");
                            App.Instalments.queryById('fldShomareHesabIdPardakht').setValue(0);
                        }
                        App.Instalments.queryById('txtBank').setValue("");
                        App.Instalments.queryById('txtShobe').setValue("");
                        App.Instalments.queryById('txtDescCh').setValue("");
                        App.Instalments.queryById('CboStatusCh').setValue("1");
                        recordd = null;
                        totalDocMablagh();
                    }
                }
            }
            else {
                Ext.MessageBox.show({
                    title: "خطا",
                    msg: "جمع مبالغ وارد شده نباید بیشتر از مبلغ کل باشد.",
                    icon: Ext.MessageBox.ERROR,
                    buttons: Ext.MessageBox.OK
                });
            }
        }
    }
    }

    function checkValidateTa(field) {
        App.Instalments.queryById(field).setValue(accounting.formatNumber(App.Instalments.queryById(field).getValue()));
        @*if (field == "TxtMablaghNa") {
            if (parseInt(App.Instalments.queryById(field).getValue().replace(',', '').replace(',', '').replace(',', '').replace(',', '').replace(',', '')) > parseInt('@ViewBag.fldMablaghNaghdi')) {
                App.Instalments.queryById(field).setValue(0);
                Ext.MessageBox.show({
                    title: "خطا",
                    msg: "مقدار وارد شده بیشتر از حد مجاز است.",
                    icon: Ext.MessageBox.ERROR,
                    buttons: Ext.MessageBox.OK
                });
            }
        }
        else {
            if (parseInt(App.Instalments.queryById(field).getValue().replace(',', '').replace(',', '').replace(',', '').replace(',', '').replace(',', '')) > parseInt('@ViewBag.fldJarimeTakhir')) {
                App.Instalments.queryById(field).setValue(0);
                Ext.MessageBox.show({
                    title: "خطا",
                    msg: "مقدار وارد شده بیشتر از حد مجاز است.",
                    icon: Ext.MessageBox.ERROR,
                    buttons: Ext.MessageBox.OK
                });
            }
        }*@
    }

    function showhideFieldset() {
        if (recordd != null) {
            recordd = null;
        }
        var DocType = App.Instalments.queryById('CboDocType').getValue();
        if (DocType == "1") {
            App.Instalments.queryById('FieldSetNaghdi').show();
            App.Instalments.queryById('FieldSetBarat').hide();
            App.Instalments.queryById('FieldSetSafteh').hide();
            App.Instalments.queryById('FieldSetCheck').hide();
            App.Instalments.queryById('FieldSetTalab').hide();
            App.Instalments.queryById('FieldSetBestankar').hide();
            App.Instalments.queryById('TxtMablaghNa').validate();
            App.Instalments.queryById('txtShomareHesabPardakht_N').validate();
            App.Instalments.queryById('TxtMablaghNa').focus(true);
        }
        else if (DocType == "5") {
            App.Instalments.queryById('FieldSetNaghdi').hide();
            App.Instalments.queryById('FieldSetBarat').hide();
            App.Instalments.queryById('FieldSetSafteh').hide();
            App.Instalments.queryById('FieldSetCheck').hide();
            App.Instalments.queryById('FieldSetTalab').show();
            App.Instalments.queryById('FieldSetBestankar').hide();
            App.Instalments.queryById('TxtMablaghTa').validate();
            App.Instalments.queryById('TxtMablaghTa').focus(true);
        }
        else if (DocType == "7") {
            App.Instalments.queryById('FieldSetNaghdi').hide();
            App.Instalments.queryById('FieldSetBarat').hide();
            App.Instalments.queryById('FieldSetSafteh').hide();
            App.Instalments.queryById('FieldSetCheck').hide();
            App.Instalments.queryById('FieldSetTalab').hide();
            App.Instalments.queryById('FieldSetBestankar').show();
            App.Instalments.queryById('TxtMablaghBes').validate();
            App.Instalments.queryById('TxtMablaghBes').focus(true);
        }
        else if (DocType == "2") {
            App.Instalments.queryById('FieldSetNaghdi').hide();
            App.Instalments.queryById('FieldSetBarat').hide();
            App.Instalments.queryById('FieldSetSafteh').hide();
            App.Instalments.queryById('FieldSetCheck').show();
            App.Instalments.queryById('FieldSetTalab').hide();
            App.Instalments.queryById('FieldSetBestankar').hide();
            App.Instalments.queryById('txtTarikhSarResidCh').validate();
            App.Instalments.queryById('txtTarikhStatusCh').validate();
            App.Instalments.queryById('txtShomareSanadCh').validate();
            App.Instalments.queryById('TxtMablaghSanadCh').validate();
            App.Instalments.queryById('txtShomareHesab').validate();
            App.Instalments.queryById('txtShomareHesabPardakht').validate();
            App.Instalments.queryById('txtBank').validate();
            App.Instalments.queryById('txtShobe').validate();
            App.Instalments.queryById('CboStatusCh').validate();
            App.Instalments.queryById('txtTarikhSarResidCh').focus(true);
        }
        else if (DocType == "3") {
            App.Instalments.queryById('FieldSetNaghdi').hide();
            App.Instalments.queryById('FieldSetBarat').hide();
            App.Instalments.queryById('FieldSetSafteh').show();
            App.Instalments.queryById('FieldSetCheck').hide();
            App.Instalments.queryById('FieldSetTalab').hide();
            App.Instalments.queryById('FieldSetBestankar').hide();
            App.Instalments.queryById('txtTarikhSarResidS').validate();
            App.Instalments.queryById('txtTarikhStatusS').validate();
            App.Instalments.queryById('txtShomareSanadS').validate();
            App.Instalments.queryById('TxtMablaghSanadS').validate();
            App.Instalments.queryById('CboStatusS').validate();
            App.Instalments.queryById('txtTarikhSarResidS').focus(true);
        }
        else if (DocType == "4") {
            App.Instalments.queryById('FieldSetNaghdi').hide();
            App.Instalments.queryById('FieldSetBarat').show();
            App.Instalments.queryById('FieldSetSafteh').hide();
            App.Instalments.queryById('FieldSetCheck').hide();
            App.Instalments.queryById('FieldSetTalab').hide();
            App.Instalments.queryById('FieldSetBestankar').hide();
            App.Instalments.queryById('txtTarikhSarResidB').validate();
            App.Instalments.queryById('txtTarikhStatusB').validate();
            App.Instalments.queryById('txtShomareSanadB').validate();
            App.Instalments.queryById('TxtMablaghSanadB').validate();
            App.Instalments.queryById('txtBaratDar').validate();
            App.Instalments.queryById('txtMakanPardakhtB').validate();
            App.Instalments.queryById('CboStatusB').validate();
            App.Instalments.queryById('txtTarikhSarResidB').focus(true);
        }
        ClearDocItems();
    }

    var ActionDoc = function (column, command, record, rowIndex) {
        if (command == "DelCommand") {
            if (record.get('fldId') != 0) {
                if (record.get('fldTypeSanad') != 1 && record.get('fldTypeSanad') != 5 && record.get('fldTypeSanad') != 7) {
                    if (record.modified.fldStatus == undefined) {/*داده ذخیره شده و مجدد ویرایش نشده*/
                        if (record.get('fldStatus') == 1) {
                            Ext.MessageBox.show({
                                title: "هشدار",
                                msg: "آیا برای حذف مطمئن هستید؟",
                                icon: Ext.MessageBox.WARNING,
                                buttons: Ext.MessageBox.YESNO,
                                fn: function (btn) {
                                    if (btn == 'yes') {
                                        DelArray.push({
                                            "fldId": record.get("fldId"),
                                            "fldTypeSanad": record.get('fldTypeSanad')
                                        });
                                        App.Instalments.queryById('InstalmentsGrid').store.remove(record);
                                        totalDocMablagh();
                                        var indexx = App.Instalments.queryById('InstalmentsGrid').store.findExact("fldTypeSanad", 1);
                                        if (indexx == -1) {
                                            App.CommandColumnInstalment.hide();
                                        }
                                    }
                                }
                            });
                        }
                        else {
                            Ext.MessageBox.show({
                                title: "خطا",
                                msg: "کاربر گرامی؛ حذف رکورد انتخاب شده امکانپذیر نمی باشد.",
                                icon: Ext.MessageBox.ERROR,
                                buttons: Ext.MessageBox.OK
                            });
                        }
                    }
                    else {
                        if (record.modified.fldStatus == 1) {
                            Ext.MessageBox.show({
                                title: "هشدار",
                                msg: "آیا برای حذف مطمئن هستید؟",
                                icon: Ext.MessageBox.WARNING,
                                buttons: Ext.MessageBox.YESNO,
                                fn: function (btn) {
                                    if (btn == 'yes') {
                                        DelArray.push({
                                            "fldId": record.get("fldId"),
                                            "fldTypeSanad": record.get('fldTypeSanad')
                                        });
                                        App.Instalments.queryById('InstalmentsGrid').store.remove(record);
                                        totalDocMablagh();
                                        var indexx = App.Instalments.queryById('InstalmentsGrid').store.findExact("fldTypeSanad", 1);
                                        if (indexx == -1) {
                                            App.CommandColumnInstalment.hide();
                                        }
                                    }
                                }
                            });
                        }
                        else {
                            Ext.MessageBox.show({
                                title: "خطا",
                                msg: "کاربر گرامی؛ حذف رکورد انتخاب شده امکانپذیر نمی باشد.",
                                icon: Ext.MessageBox.ERROR,
                                buttons: Ext.MessageBox.OK
                            });
                        }
                    }
                }
                else {
                    if (record.get('fldTypeSanad') == 1) {/*نقدی*/
                        if (record.get('fldStatusFishId') == "2") {
                            Ext.MessageBox.show({
                                title: "خطا",
                                msg: "کاربر گرامی؛ برای سند مورد نظر فیش صادر شده است و امکان حذف وجود ندارد.",
                                icon: Ext.MessageBox.ERROR,
                                buttons: Ext.MessageBox.OK
                            });
                        }
                        else {
                            Ext.MessageBox.show({
                                title: "هشدار",
                                msg: "آیا برای حذف مطمئن هستید؟",
                                icon: Ext.MessageBox.WARNING,
                                buttons: Ext.MessageBox.YESNO,
                                fn: function (btn) {
                                    if (btn == 'yes') {
                                        DelArray.push({
                                            "fldId": record.get("fldId"),
                                            "fldTypeSanad": record.get('fldTypeSanad')
                                        });
                                        App.Instalments.queryById('InstalmentsGrid').store.remove(record);
                                        totalDocMablagh();
                                        var indexx = App.Instalments.queryById('InstalmentsGrid').store.findExact("fldTypeSanad", 1);
                                        if (indexx == -1) {
                                            App.CommandColumnInstalment.hide();
                                        }
                                    }
                                }
                            });
                        }
                    }
                    else {
                        Ext.MessageBox.show({
                            title: "هشدار",
                            msg: "آیا برای حذف مطمئن هستید؟",
                            icon: Ext.MessageBox.WARNING,
                            buttons: Ext.MessageBox.YESNO,
                            fn: function (btn) {
                                if (btn == 'yes') {
                                    DelArray.push({
                                        "fldId": record.get("fldId"),
                                        "fldTypeSanad": record.get('fldTypeSanad')
                                    });
                                    App.Instalments.queryById('InstalmentsGrid').store.remove(record);
                                    totalDocMablagh();
                                    var indexx = App.Instalments.queryById('InstalmentsGrid').store.findExact("fldTypeSanad", 1);
                                    if (indexx == -1) {
                                        App.CommandColumnInstalment.hide();
                                    }
                                }
                            }
                        });
                    }
                }
            }
            else {
                Ext.MessageBox.show({
                    title: "هشدار",
                    msg: "آیا برای حذف مطمئن هستید؟",
                    icon: Ext.MessageBox.WARNING,
                    buttons: Ext.MessageBox.YESNO,
                    fn: function (btn) {
                        if (btn == 'yes') {
                            App.Instalments.queryById('InstalmentsGrid').store.remove(record);
                            totalDocMablagh();
                            var indexx = App.Instalments.queryById('InstalmentsGrid').store.findExact("fldTypeSanad", 1);
                            if (indexx == -1) {
                                App.CommandColumnInstalment.hide();
                            }
                        }
                    }
                });
            }
        }
        else if (command == "CopyCommand") {
            recordd = null;
            if (record.get('fldTypeSanad') == 2 || record.get('fldTypeSanad') == 6) {/*چک*/
                App.Instalments.queryById('FieldSetNaghdi').hide();
                App.Instalments.queryById('FieldSetBarat').hide();
                App.Instalments.queryById('FieldSetSafteh').hide();
                App.Instalments.queryById('FieldSetCheck').show();
                App.Instalments.queryById('FieldSetTalab').hide();
                App.Instalments.queryById('FieldSetBestankar').hide();
                if (record.get('fldTypeSanad') == 6) {/*ضمانتی*/
                    TypeSanadCh = "1";
                }
                else {
                    TypeSanadCh = "0";
                }
                App.Instalments.queryById('CboTypeSanadCh').setValue(TypeSanadCh);
                App.Instalments.queryById('txtTarikhSarResidCh').setValue("");
                App.Instalments.queryById('txtTarikhStatusCh').setValue("");
                App.Instalments.queryById('txtShomareSanadCh').setValue("");
                App.Instalments.queryById('TxtMablaghSanadCh').setValue(record.get('fldMablaghSanad'));
                App.Instalments.queryById('txtShomareHesab').setValue(record.get('fldShomareHesab'));
                App.Instalments.queryById('fldShomareHesabId').setValue(record.get('fldShomareHesabId'));
                App.Instalments.queryById('txtShomareHesabPardakht').setValue(record.get('fldShomareHesabOrgan'));
                App.Instalments.queryById('fldShomareHesabIdPardakht').setValue(record.get('fldShomareHesabIdOrgan'));
                App.Instalments.queryById('txtBank').setValue(record.get('fldBankName'));
                App.Instalments.queryById('txtShobe').setValue(record.get('fldNameShobe'));
                App.Instalments.queryById('CboStatusCh').setValue(String(record.get('fldStatus')));
                App.Instalments.queryById('txtDescCh').setValue("");
                App.Instalments.queryById('CboDocType').setValue("2");
            }
            else if (record.get('fldTypeSanad') == 3) {/*سفته*/
                App.Instalments.queryById('FieldSetNaghdi').hide();
                App.Instalments.queryById('FieldSetBarat').hide();
                App.Instalments.queryById('FieldSetSafteh').show();
                App.Instalments.queryById('FieldSetCheck').hide();
                App.Instalments.queryById('FieldSetTalab').hide();
                App.Instalments.queryById('FieldSetBestankar').hide();
                App.Instalments.queryById('txtTarikhSarResidS').setValue("");
                App.Instalments.queryById('txtTarikhStatusS').setValue("");
                App.Instalments.queryById('txtShomareSanadS').setValue("");
                App.Instalments.queryById('TxtMablaghSanadS').setValue(record.get('fldMablaghSanad'));
                App.Instalments.queryById('txtDescS').setValue("");
                App.Instalments.queryById('CboStatusS').setValue(String(record.get('fldStatus')));
                App.Instalments.queryById('CboDocType').setValue("3");
            }
            else if (record.get('fldTypeSanad') == 4) {/*برات*/
                App.Instalments.queryById('FieldSetNaghdi').hide();
                App.Instalments.queryById('FieldSetBarat').show();
                App.Instalments.queryById('FieldSetSafteh').hide();
                App.Instalments.queryById('FieldSetCheck').hide();
                App.Instalments.queryById('FieldSetTalab').hide();
                App.Instalments.queryById('FieldSetBestankar').hide();
                App.Instalments.queryById('txtTarikhSarResidB').setValue("");
                App.Instalments.queryById('txtTarikhStatusB').setValue("");
                App.Instalments.queryById('txtShomareSanadB').setValue("");
                App.Instalments.queryById('TxtMablaghSanadB').setValue(record.get('fldMablaghSanad'));
                App.Instalments.queryById('txtBaratDar').setValue(record.get('fldNameBaratDar'));
                App.Instalments.queryById('fldBaratDarId').setValue(record.get('fldBaratDarId'));
                App.Instalments.queryById('txtMakanPardakhtB').setValue(record.get('fldMakanPardakht'));
                App.Instalments.queryById('txtDescB').setValue("");
                App.Instalments.queryById('CboStatusB').setValue(String(record.get('fldStatus')));
                App.Instalments.queryById('CboDocType').setValue("4");
            }
        }
        else if (command == "EditCommand") {
            if (record.get('fldId') != 0) {/*داده های ذخیره شده*/
                if (record.get('fldTypeSanad') != 1 && record.get('fldTypeSanad') != 5 && record.get('fldTypeSanad') != 7) {
                    if (record.modified.fldStatus == undefined) {/*داده ذخیره شده و مجدد ویرایش نشده*/
                        if (record.get('fldStatus') == 1) {
                            recordd = record;
                            if (record.get('fldTypeSanad') == 2 || record.get('fldTypeSanad') == 6) {/*چک*/
                                App.Instalments.queryById('FieldSetNaghdi').hide();
                                App.Instalments.queryById('FieldSetBarat').hide();
                                App.Instalments.queryById('FieldSetSafteh').hide();
                                App.Instalments.queryById('FieldSetCheck').show();
                                App.Instalments.queryById('FieldSetTalab').hide();
                                App.Instalments.queryById('FieldSetBestankar').hide();
                                /*App.Instalments.queryById('TxtMablaghTa').setValue("");
                                App.Instalments.queryById('Talab_NaghdiId').setValue(0);
                                App.Instalments.queryById('TxtMablaghNa').setValue("");
                                App.Instalments.queryById('txtTarikhSarResidS').setValue("");
                                App.Instalments.queryById('txtShomareSanadS').setValue("");
                                App.Instalments.queryById('TxtMablaghSanadS').setValue("");
                                App.Instalments.queryById('SaftehId').setValue(0);
                                App.Instalments.queryById('txtTarikhSarResidB').setValue("");
                                App.Instalments.queryById('txtShomareSanadB').setValue("");
                                App.Instalments.queryById('TxtMablaghSanadB').setValue("");
                                App.Instalments.queryById('txtBaratDar').setValue("");
                                App.Instalments.queryById('fldBaratDarId').setValue(0);
                                App.Instalments.queryById('txtMakanPardakhtB').setValue("");
                                App.Instalments.queryById('BaratId').setValue(0);*/
                                if (record.get('fldTypeSanad') == 6) {/*ضمانتی*/
                                    TypeSanadCh = "1";
                                }
                                else {
                                    TypeSanadCh = "0";
                                }
                                App.Instalments.queryById('CboTypeSanadCh').setValue(TypeSanadCh);
                                App.Instalments.queryById('txtTarikhSarResidCh').setValue(record.get('fldTarikhSarResid'));
                                App.Instalments.queryById('txtTarikhStatusCh').setValue(record.get('fldDateStatus'));
                                App.Instalments.queryById('txtShomareSanadCh').setValue(record.get('fldShomareSanad'));
                                App.Instalments.queryById('TxtMablaghSanadCh').setValue(record.get('fldMablaghSanad'));
                                App.Instalments.queryById('txtShomareHesab').setValue(record.get('fldShomareHesab'));
                                App.Instalments.queryById('fldShomareHesabId').setValue(record.get('fldShomareHesabId'));
                                App.Instalments.queryById('txtShomareHesabPardakht').setValue(record.get('fldShomareHesabOrgan'));
                                App.Instalments.queryById('fldShomareHesabIdPardakht').setValue(record.get('fldShomareHesabIdOrgan'));
                                App.Instalments.queryById('txtBank').setValue(record.get('fldBankName'));
                                App.Instalments.queryById('txtShobe').setValue(record.get('fldNameShobe'));
                                App.Instalments.queryById('CboStatusCh').setValue(String(record.get('fldStatus')));
                                App.Instalments.queryById('txtDescCh').setValue(record.get('fldDesc'));
                                App.Instalments.queryById('CboDocType').setValue("2");
                                /*App.Instalments.queryById('CheckId').setValue(record.get('fldId'));*/
                            }
                            else if (record.get('fldTypeSanad') == 3) {/*سفته*/
                                App.Instalments.queryById('FieldSetNaghdi').hide();
                                App.Instalments.queryById('FieldSetBarat').hide();
                                App.Instalments.queryById('FieldSetSafteh').show();
                                App.Instalments.queryById('FieldSetCheck').hide();
                                App.Instalments.queryById('FieldSetTalab').hide();
                                App.Instalments.queryById('FieldSetBestankar').hide();
                                /*App.Instalments.queryById('TxtMablaghTa').setValue("");
                                App.Instalments.queryById('Talab_NaghdiId').setValue(0);
                                App.Instalments.queryById('TxtMablaghNa').setValue("");*/
                                App.Instalments.queryById('txtTarikhSarResidS').setValue(record.get('fldTarikhSarResid'));
                                App.Instalments.queryById('txtTarikhStatusS').setValue(record.get('fldDateStatus'));
                                App.Instalments.queryById('txtShomareSanadS').setValue(record.get('fldShomareSanad'));
                                App.Instalments.queryById('TxtMablaghSanadS').setValue(record.get('fldMablaghSanad'));
                                App.Instalments.queryById('txtDescS').setValue(record.get('fldDesc'));
                                App.Instalments.queryById('CboStatusS').setValue(String(record.get('fldStatus')));
                                App.Instalments.queryById('CboDocType').setValue("3");

                                /*App.Instalments.queryById('SaftehId').setValue(record.get('fldId'));*/
                                /*App.Instalments.queryById('txtTarikhSarResidB').setValue("");
                                App.Instalments.queryById('txtShomareSanadB').setValue("");
                                App.Instalments.queryById('TxtMablaghSanadB').setValue("");
                                App.Instalments.queryById('txtBaratDar').setValue("");
                                App.Instalments.queryById('fldBaratDarId').setValue(0);
                                App.Instalments.queryById('txtMakanPardakhtB').setValue("");
                                App.Instalments.queryById('BaratId').setValue(0);
                                App.Instalments.queryById('txtTarikhSarResidCh').setValue("");
                                App.Instalments.queryById('txtShomareSanadCh').setValue("");
                                App.Instalments.queryById('TxtMablaghSanadCh').setValue("");
                                App.Instalments.queryById('txtShomareHesab').setValue("");
                                App.Instalments.queryById('fldShomareHesabId').setValue(0);
                                App.Instalments.queryById('txtBank').setValue("");
                                App.Instalments.queryById('txtShobe').setValue("");
                                App.Instalments.queryById('CheckId').setValue(0);*/
                            }
                            else if (record.get('fldTypeSanad') == 4) {/*برات*/
                                App.Instalments.queryById('FieldSetNaghdi').hide();
                                App.Instalments.queryById('FieldSetBarat').show();
                                App.Instalments.queryById('FieldSetSafteh').hide();
                                App.Instalments.queryById('FieldSetCheck').hide();
                                App.Instalments.queryById('FieldSetTalab').hide();
                                App.Instalments.queryById('FieldSetBestankar').hide();
                                /*App.Instalments.queryById('TxtMablaghTa').setValue("");
                                App.Instalments.queryById('Talab_NaghdiId').setValue(0);
                                App.Instalments.queryById('TxtMablaghNa').setValue("");
                                App.Instalments.queryById('txtTarikhSarResidS').setValue("");
                                App.Instalments.queryById('txtShomareSanadS').setValue("");
                                App.Instalments.queryById('TxtMablaghSanadS').setValue("");
                                App.Instalments.queryById('SaftehId').setValue(0);*/
                                App.Instalments.queryById('txtTarikhSarResidB').setValue(record.get('fldTarikhSarResid'));
                                App.Instalments.queryById('txtTarikhStatusB').setValue(record.get('fldDateStatus'));
                                App.Instalments.queryById('txtShomareSanadB').setValue(record.get('fldShomareSanad'));
                                App.Instalments.queryById('TxtMablaghSanadB').setValue(record.get('fldMablaghSanad'));
                                App.Instalments.queryById('txtBaratDar').setValue(record.get('fldNameBaratDar'));
                                App.Instalments.queryById('fldBaratDarId').setValue(record.get('fldBaratDarId'));
                                App.Instalments.queryById('txtMakanPardakhtB').setValue(record.get('fldMakanPardakht'));
                                App.Instalments.queryById('txtDescB').setValue(record.get('fldDesc'));
                                App.Instalments.queryById('CboStatusB').setValue(String(record.get('fldStatus')));
                                App.Instalments.queryById('CboDocType').setValue("4");
                                /*App.Instalments.queryById('BaratId').setValue(record.get('fldId'));*/
                                /*App.Instalments.queryById('txtTarikhSarResidCh').setValue("");
                                App.Instalments.queryById('txtShomareSanadCh').setValue("");
                                App.Instalments.queryById('TxtMablaghSanadCh').setValue("");
                                App.Instalments.queryById('txtShomareHesab').setValue("");
                                App.Instalments.queryById('fldShomareHesabId').setValue(0);
                                App.Instalments.queryById('txtBank').setValue("");
                                App.Instalments.queryById('txtShobe').setValue("");
                                App.Instalments.queryById('CheckId').setValue(0);*/
                            }
                        }
                        else {
                            Ext.MessageBox.show({
                                title: "خطا",
                                msg: "کاربر گرامی؛ ویرایش رکورد انتخاب شده امکانپذیر نمی باشد.",
                                icon: Ext.MessageBox.ERROR,
                                buttons: Ext.MessageBox.OK
                            });
                        }
                    }
                    else {
                        /*if (record.modified.fldStatus == 1) {*/
                        recordd = record;
                        if (record.get('fldTypeSanad') == 2 || record.get('fldTypeSanad') == 6) {/*چک*/
                            App.Instalments.queryById('FieldSetNaghdi').hide();
                            App.Instalments.queryById('FieldSetBarat').hide();
                            App.Instalments.queryById('FieldSetSafteh').hide();
                            App.Instalments.queryById('FieldSetCheck').show();
                            App.Instalments.queryById('FieldSetTalab').hide();
                            App.Instalments.queryById('FieldSetBestankar').hide();
                            /*App.Instalments.queryById('TxtMablaghTa').setValue("");
                            App.Instalments.queryById('Talab_NaghdiId').setValue(0);
                            App.Instalments.queryById('TxtMablaghNa').setValue("");
                            App.Instalments.queryById('txtTarikhSarResidS').setValue("");
                            App.Instalments.queryById('txtShomareSanadS').setValue("");
                            App.Instalments.queryById('TxtMablaghSanadS').setValue("");
                            App.Instalments.queryById('SaftehId').setValue(0);
                            App.Instalments.queryById('txtTarikhSarResidB').setValue("");
                            App.Instalments.queryById('txtShomareSanadB').setValue("");
                            App.Instalments.queryById('TxtMablaghSanadB').setValue("");
                            App.Instalments.queryById('txtBaratDar').setValue("");
                            App.Instalments.queryById('fldBaratDarId').setValue(0);
                            App.Instalments.queryById('txtMakanPardakhtB').setValue("");
                            App.Instalments.queryById('BaratId').setValue(0);*/
                            if (record.get('fldTypeSanad') == 6) {/*ضمانتی*/
                                TypeSanadCh = "1";
                            }
                            else {
                                TypeSanadCh = "0";
                            }
                            App.Instalments.queryById('CboTypeSanadCh').setValue(TypeSanadCh);
                            App.Instalments.queryById('txtTarikhSarResidCh').setValue(record.get('fldTarikhSarResid'));
                            App.Instalments.queryById('txtTarikhStatusCh').setValue(record.get('fldDateStatus'));
                            App.Instalments.queryById('txtShomareSanadCh').setValue(record.get('fldShomareSanad'));
                            App.Instalments.queryById('TxtMablaghSanadCh').setValue(record.get('fldMablaghSanad'));
                            App.Instalments.queryById('txtShomareHesab').setValue(record.get('fldShomareHesab'));
                            App.Instalments.queryById('fldShomareHesabId').setValue(record.get('fldShomareHesabId'));
                            App.Instalments.queryById('txtShomareHesabPardakht').setValue(record.get('fldShomareHesabOrgan'));
                            App.Instalments.queryById('fldShomareHesabIdPardakht').setValue(record.get('fldShomareHesabIdOrgan'));
                            App.Instalments.queryById('txtBank').setValue(record.get('fldBankName'));
                            App.Instalments.queryById('txtShobe').setValue(record.get('fldNameShobe'));
                            App.Instalments.queryById('CboStatusCh').setValue(String(record.get('fldStatus')));
                            App.Instalments.queryById('txtDescCh').setValue(record.get('fldDesc'));
                            App.Instalments.queryById('CboDocType').setValue("2");
                            /*App.Instalments.queryById('CheckId').setValue(record.get('fldId'));*/
                        }
                        else if (record.get('fldTypeSanad') == 3) {/*سفته*/
                            App.Instalments.queryById('FieldSetNaghdi').hide();
                            App.Instalments.queryById('FieldSetBarat').hide();
                            App.Instalments.queryById('FieldSetSafteh').show();
                            App.Instalments.queryById('FieldSetCheck').hide();
                            App.Instalments.queryById('FieldSetTalab').hide();
                            App.Instalments.queryById('FieldSetBestankar').hide();
                            /*App.Instalments.queryById('TxtMablaghTa').setValue("");
                            App.Instalments.queryById('Talab_NaghdiId').setValue(0);
                            App.Instalments.queryById('TxtMablaghNa').setValue("");*/
                            App.Instalments.queryById('txtTarikhSarResidS').setValue(record.get('fldTarikhSarResid'));
                            App.Instalments.queryById('txtTarikhStatusS').setValue(record.get('fldDateStatus'));
                            App.Instalments.queryById('txtShomareSanadS').setValue(record.get('fldShomareSanad'));
                            App.Instalments.queryById('TxtMablaghSanadS').setValue(record.get('fldMablaghSanad'));
                            App.Instalments.queryById('txtDescS').setValue(record.get('fldDesc'));
                            App.Instalments.queryById('CboStatusS').setValue(String(record.get('fldStatus')));
                            App.Instalments.queryById('CboDocType').setValue("3");
                            /*App.Instalments.queryById('SaftehId').setValue(record.get('fldId'));*/
                            /*App.Instalments.queryById('txtTarikhSarResidB').setValue("");
                            App.Instalments.queryById('txtShomareSanadB').setValue("");
                            App.Instalments.queryById('TxtMablaghSanadB').setValue("");
                            App.Instalments.queryById('txtBaratDar').setValue("");
                            App.Instalments.queryById('fldBaratDarId').setValue(0);
                            App.Instalments.queryById('txtMakanPardakhtB').setValue("");
                            App.Instalments.queryById('BaratId').setValue(0);
                            App.Instalments.queryById('txtTarikhSarResidCh').setValue("");
                            App.Instalments.queryById('txtShomareSanadCh').setValue("");
                            App.Instalments.queryById('TxtMablaghSanadCh').setValue("");
                            App.Instalments.queryById('txtShomareHesab').setValue("");
                            App.Instalments.queryById('fldShomareHesabId').setValue(0);
                            App.Instalments.queryById('txtBank').setValue("");
                            App.Instalments.queryById('txtShobe').setValue("");
                            App.Instalments.queryById('CheckId').setValue(0);*/
                        }
                        else if (record.get('fldTypeSanad') == 4) {/*برات*/
                            App.Instalments.queryById('FieldSetNaghdi').hide();
                            App.Instalments.queryById('FieldSetBarat').show();
                            App.Instalments.queryById('FieldSetSafteh').hide();
                            App.Instalments.queryById('FieldSetCheck').hide();
                            App.Instalments.queryById('FieldSetTalab').hide();
                            App.Instalments.queryById('FieldSetBestankar').hide();
                            /*App.Instalments.queryById('TxtMablaghTa').setValue("");
                            App.Instalments.queryById('Talab_NaghdiId').setValue(0);
                            App.Instalments.queryById('TxtMablaghNa').setValue("");
                            App.Instalments.queryById('txtTarikhSarResidS').setValue("");
                            App.Instalments.queryById('txtShomareSanadS').setValue("");
                            App.Instalments.queryById('TxtMablaghSanadS').setValue("");
                            App.Instalments.queryById('SaftehId').setValue(0);*/
                            App.Instalments.queryById('txtTarikhSarResidB').setValue(record.get('fldTarikhSarResid'));
                            App.Instalments.queryById('txtTarikhStatusB').setValue(record.get('fldDateStatus'));
                            App.Instalments.queryById('txtShomareSanadB').setValue(record.get('fldShomareSanad'));
                            App.Instalments.queryById('TxtMablaghSanadB').setValue(record.get('fldMablaghSanad'));
                            App.Instalments.queryById('txtBaratDar').setValue(record.get('fldNameBaratDar'));
                            App.Instalments.queryById('fldBaratDarId').setValue(record.get('fldBaratDarId'));
                            App.Instalments.queryById('txtMakanPardakhtB').setValue(record.get('fldMakanPardakht'));
                            App.Instalments.queryById('txtDescB').setValue(record.get('fldDesc'));
                            App.Instalments.queryById('CboStatusB').setValue(String(record.get('fldStatus')));
                            App.Instalments.queryById('CboDocType').setValue("4");
                            /*App.Instalments.queryById('BaratId').setValue(record.get('fldId'));*/
                            /*App.Instalments.queryById('txtTarikhSarResidCh').setValue("");
                            App.Instalments.queryById('txtShomareSanadCh').setValue("");
                            App.Instalments.queryById('TxtMablaghSanadCh').setValue("");
                            App.Instalments.queryById('txtShomareHesab').setValue("");
                            App.Instalments.queryById('fldShomareHesabId').setValue(0);
                            App.Instalments.queryById('txtBank').setValue("");
                            App.Instalments.queryById('txtShobe').setValue("");
                            App.Instalments.queryById('CheckId').setValue(0);*/
                        }
                        /*}
                        else {
                            Ext.MessageBox.show({
                                title: "خطا",
                                msg: "کاربر گرامی؛ ویرایش رکورد انتخاب شده امکانپذیر نمی باشد.",
                                icon: Ext.MessageBox.ERROR,
                                buttons: Ext.MessageBox.OK
                            });
                        }*/
                    }
                }
                else {
                    if (record.get('fldTypeSanad') == 1) {/*نقدی*/
                        if (record.get('fldStatusFishId') == "2") {
                            Ext.MessageBox.show({
                                title: "خطا",
                                msg: "کاربر گرامی؛ برای سند مورد نظر فیش صادر شده است و امکان ویرایش وجود ندارد.",
                                icon: Ext.MessageBox.ERROR,
                                buttons: Ext.MessageBox.OK
                            });
                        }
                        else {
                            recordd = record;
                            App.Instalments.queryById('FieldSetNaghdi').show();
                            App.Instalments.queryById('FieldSetBarat').hide();
                            App.Instalments.queryById('FieldSetSafteh').hide();
                            App.Instalments.queryById('FieldSetCheck').hide();
                            App.Instalments.queryById('FieldSetTalab').hide();
                            App.Instalments.queryById('FieldSetBestankar').hide();
                            App.Instalments.queryById('TxtMablaghNa').setValue(record.get('fldMablaghSanad'));
                            App.Instalments.queryById('txtShomareHesabPardakht_N').setValue(record.get('fldShomareHesabOrgan'));
                            App.Instalments.queryById('fldShomareHesabIdPardakht_N').setValue(record.get('fldShomareHesabIdOrgan'));
                            App.Instalments.queryById('txtDescNa').setValue(record.get('fldDesc'));
                            App.Instalments.queryById('CboDocType').setValue("1");
                            /*App.Instalments.queryById('Talab_NaghdiId').setValue(record.get('fldId'));*/
                            /*App.Instalments.queryById('TxtMablaghTa').setValue("");
                            App.Instalments.queryById('txtTarikhSarResidS').setValue("");
                            App.Instalments.queryById('txtShomareSanadS').setValue("");
                            App.Instalments.queryById('TxtMablaghSanadS').setValue("");
                            App.Instalments.queryById('SaftehId').setValue(0);
                            App.Instalments.queryById('txtTarikhSarResidB').setValue("");
                            App.Instalments.queryById('txtShomareSanadB').setValue("");
                            App.Instalments.queryById('TxtMablaghSanadB').setValue("");
                            App.Instalments.queryById('txtBaratDar').setValue("");
                            App.Instalments.queryById('fldBaratDarId').setValue(0);
                            App.Instalments.queryById('txtMakanPardakhtB').setValue("");
                            App.Instalments.queryById('BaratId').setValue(0);
                            App.Instalments.queryById('txtTarikhSarResidCh').setValue("");
                            App.Instalments.queryById('txtShomareSanadCh').setValue("");
                            App.Instalments.queryById('TxtMablaghSanadCh').setValue("");
                            App.Instalments.queryById('txtShomareHesab').setValue("");
                            App.Instalments.queryById('fldShomareHesabId').setValue(0);
                            App.Instalments.queryById('txtBank').setValue("");
                            App.Instalments.queryById('txtShobe').setValue("");
                            App.Instalments.queryById('CheckId').setValue(0);*/
                        }
                    }
                    else if (record.get('fldTypeSanad') == 5) {/*بدهکاری*/
                        recordd = record;
                        App.Instalments.queryById('FieldSetNaghdi').hide();
                        App.Instalments.queryById('FieldSetBarat').hide();
                        App.Instalments.queryById('FieldSetSafteh').hide();
                        App.Instalments.queryById('FieldSetCheck').hide();
                        App.Instalments.queryById('FieldSetTalab').show();
                        App.Instalments.queryById('FieldSetBestankar').hide();
                        App.Instalments.queryById('TxtMablaghTa').setValue(record.get('fldMablaghSanad'));
                        App.Instalments.queryById('txtDescTa').setValue(record.get('fldDesc'));
                        App.Instalments.queryById('CboDocType').setValue("5");
                        /*App.Instalments.queryById('Talab_NaghdiId').setValue(record.get('fldId'));
                        App.Instalments.queryById('TxtMablaghNa').setValue("");
                        App.Instalments.queryById('txtTarikhSarResidS').setValue("");
                        App.Instalments.queryById('txtShomareSanadS').setValue("");
                        App.Instalments.queryById('TxtMablaghSanadS').setValue("");
                        App.Instalments.queryById('SaftehId').setValue(0);
                        App.Instalments.queryById('txtTarikhSarResidB').setValue("");
                        App.Instalments.queryById('txtShomareSanadB').setValue("");
                        App.Instalments.queryById('TxtMablaghSanadB').setValue("");
                        App.Instalments.queryById('txtBaratDar').setValue("");
                        App.Instalments.queryById('fldBaratDarId').setValue(0);
                        App.Instalments.queryById('txtMakanPardakhtB').setValue("");
                        App.Instalments.queryById('BaratId').setValue(0);
                        App.Instalments.queryById('txtTarikhSarResidCh').setValue("");
                        App.Instalments.queryById('txtShomareSanadCh').setValue("");
                        App.Instalments.queryById('TxtMablaghSanadCh').setValue("");
                        App.Instalments.queryById('txtShomareHesab').setValue("");
                        App.Instalments.queryById('fldShomareHesabId').setValue(0);
                        App.Instalments.queryById('txtBank').setValue("");
                        App.Instalments.queryById('txtShobe').setValue("");
                        App.Instalments.queryById('CheckId').setValue(0);*/
                    }
                    else if (record.get('fldTypeSanad') == 7) {/*بستانکاری*/
                        recordd = record;
                        App.Instalments.queryById('FieldSetNaghdi').hide();
                        App.Instalments.queryById('FieldSetBarat').hide();
                        App.Instalments.queryById('FieldSetSafteh').hide();
                        App.Instalments.queryById('FieldSetCheck').hide();
                        App.Instalments.queryById('FieldSetTalab').hide();
                        App.Instalments.queryById('FieldSetBestankar').show();
                        App.Instalments.queryById('TxtMablaghBes').setValue(record.get('fldMablaghSanad'));
                        App.Instalments.queryById('txtDescBes').setValue(record.get('fldDesc'));
                        App.Instalments.queryById('CboDocType').setValue("7");
                        /*App.Instalments.queryById('Talab_NaghdiId').setValue(record.get('fldId'));
                        App.Instalments.queryById('TxtMablaghNa').setValue("");
                        App.Instalments.queryById('txtTarikhSarResidS').setValue("");
                        App.Instalments.queryById('txtShomareSanadS').setValue("");
                        App.Instalments.queryById('TxtMablaghSanadS').setValue("");
                        App.Instalments.queryById('SaftehId').setValue(0);
                        App.Instalments.queryById('txtTarikhSarResidB').setValue("");
                        App.Instalments.queryById('txtShomareSanadB').setValue("");
                        App.Instalments.queryById('TxtMablaghSanadB').setValue("");
                        App.Instalments.queryById('txtBaratDar').setValue("");
                        App.Instalments.queryById('fldBaratDarId').setValue(0);
                        App.Instalments.queryById('txtMakanPardakhtB').setValue("");
                        App.Instalments.queryById('BaratId').setValue(0);
                        App.Instalments.queryById('txtTarikhSarResidCh').setValue("");
                        App.Instalments.queryById('txtShomareSanadCh').setValue("");
                        App.Instalments.queryById('TxtMablaghSanadCh').setValue("");
                        App.Instalments.queryById('txtShomareHesab').setValue("");
                        App.Instalments.queryById('fldShomareHesabId').setValue(0);
                        App.Instalments.queryById('txtBank').setValue("");
                        App.Instalments.queryById('txtShobe').setValue("");
                        App.Instalments.queryById('CheckId').setValue(0);*/
                    }
                }
            }
            else {/*داده های ذخیره نشده*/
                recordd = record;
                if (record.get('fldTypeSanad') == 1) {/*نقدی*/
                    App.Instalments.queryById('FieldSetNaghdi').show();
                    App.Instalments.queryById('FieldSetBarat').hide();
                    App.Instalments.queryById('FieldSetSafteh').hide();
                    App.Instalments.queryById('FieldSetCheck').hide();
                    App.Instalments.queryById('FieldSetTalab').hide();
                    App.Instalments.queryById('FieldSetBestankar').hide();
                    App.Instalments.queryById('TxtMablaghNa').setValue(record.get('fldMablaghSanad'));
                    App.Instalments.queryById('txtShomareHesabPardakht_N').setValue(record.get('fldShomareHesabOrgan'));
                    App.Instalments.queryById('fldShomareHesabIdPardakht_N').setValue(record.get('fldShomareHesabIdOrgan'));
                    App.Instalments.queryById('txtDescNa').setValue(record.get('fldDesc'));
                    App.Instalments.queryById('CboDocType').setValue("1");
                    /*App.Instalments.queryById('Talab_NaghdiId').setValue(record.get('fldId'));*/
                    /*App.Instalments.queryById('TxtMablaghTa').setValue("");
                    App.Instalments.queryById('txtTarikhSarResidS').setValue("");
                    App.Instalments.queryById('txtShomareSanadS').setValue("");
                    App.Instalments.queryById('TxtMablaghSanadS').setValue("");
                    App.Instalments.queryById('SaftehId').setValue(0);
                    App.Instalments.queryById('txtTarikhSarResidB').setValue("");
                    App.Instalments.queryById('txtShomareSanadB').setValue("");
                    App.Instalments.queryById('TxtMablaghSanadB').setValue("");
                    App.Instalments.queryById('txtBaratDar').setValue("");
                    App.Instalments.queryById('fldBaratDarId').setValue(0);
                    App.Instalments.queryById('txtMakanPardakhtB').setValue("");
                    App.Instalments.queryById('BaratId').setValue(0);
                    App.Instalments.queryById('txtTarikhSarResidCh').setValue("");
                    App.Instalments.queryById('txtShomareSanadCh').setValue("");
                    App.Instalments.queryById('TxtMablaghSanadCh').setValue("");
                    App.Instalments.queryById('txtShomareHesab').setValue("");
                    App.Instalments.queryById('fldShomareHesabId').setValue(0);
                    App.Instalments.queryById('txtBank').setValue("");
                    App.Instalments.queryById('txtShobe').setValue("");
                    App.Instalments.queryById('CheckId').setValue(0);*/
                }
                else if (record.get('fldTypeSanad') == 2 || record.get('fldTypeSanad') == 6) {/*چک*/
                    App.Instalments.queryById('FieldSetNaghdi').hide();
                    App.Instalments.queryById('FieldSetBarat').hide();
                    App.Instalments.queryById('FieldSetSafteh').hide();
                    App.Instalments.queryById('FieldSetCheck').show();
                    App.Instalments.queryById('FieldSetTalab').hide();
                    App.Instalments.queryById('FieldSetBestankar').hide();
                    /*App.Instalments.queryById('TxtMablaghTa').setValue("");
                    App.Instalments.queryById('Talab_NaghdiId').setValue(0);
                    App.Instalments.queryById('TxtMablaghNa').setValue("");
                    App.Instalments.queryById('txtTarikhSarResidS').setValue("");
                    App.Instalments.queryById('txtShomareSanadS').setValue("");
                    App.Instalments.queryById('TxtMablaghSanadS').setValue("");
                    App.Instalments.queryById('SaftehId').setValue(0);
                    App.Instalments.queryById('txtTarikhSarResidB').setValue("");
                    App.Instalments.queryById('txtShomareSanadB').setValue("");
                    App.Instalments.queryById('TxtMablaghSanadB').setValue("");
                    App.Instalments.queryById('txtBaratDar').setValue("");
                    App.Instalments.queryById('fldBaratDarId').setValue(0);
                    App.Instalments.queryById('txtMakanPardakhtB').setValue("");
                    App.Instalments.queryById('BaratId').setValue(0);*/
                    if (record.get('fldTypeSanad') == 6) {/*ضمانتی*/
                        TypeSanadCh = "1";
                    }
                    else {
                        TypeSanadCh = "0";
                    }
                    App.Instalments.queryById('CboTypeSanadCh').setValue(TypeSanadCh);
                    App.Instalments.queryById('txtTarikhSarResidCh').setValue(record.get('fldTarikhSarResid'));
                    App.Instalments.queryById('txtTarikhStatusCh').setValue(record.get('fldDateStatus'));
                    App.Instalments.queryById('txtShomareSanadCh').setValue(record.get('fldShomareSanad'));
                    App.Instalments.queryById('TxtMablaghSanadCh').setValue(record.get('fldMablaghSanad'));
                    App.Instalments.queryById('txtShomareHesab').setValue(record.get('fldShomareHesab'));
                    App.Instalments.queryById('fldShomareHesabId').setValue(record.get('fldShomareHesabId'));
                    App.Instalments.queryById('txtShomareHesabPardakht').setValue(record.get('fldShomareHesabOrgan'));
                    App.Instalments.queryById('fldShomareHesabIdPardakht').setValue(record.get('fldShomareHesabIdOrgan'));
                    App.Instalments.queryById('txtBank').setValue(record.get('fldBankName'));
                    App.Instalments.queryById('txtShobe').setValue(record.get('fldNameShobe'));
                    App.Instalments.queryById('CboStatusCh').setValue(String(record.get('fldStatus')));
                    App.Instalments.queryById('txtDescCh').setValue(record.get('fldDesc'));
                    App.Instalments.queryById('CboDocType').setValue("2");
                    /*App.Instalments.queryById('CheckId').setValue(record.get('fldId'));*/
                }
                else if (record.get('fldTypeSanad') == 3) {/*سفته*/
                    App.Instalments.queryById('FieldSetNaghdi').hide();
                    App.Instalments.queryById('FieldSetBarat').hide();
                    App.Instalments.queryById('FieldSetSafteh').show();
                    App.Instalments.queryById('FieldSetCheck').hide();
                    App.Instalments.queryById('FieldSetTalab').hide();
                    App.Instalments.queryById('FieldSetBestankar').hide();
                    /*App.Instalments.queryById('TxtMablaghTa').setValue("");
                    App.Instalments.queryById('Talab_NaghdiId').setValue(0);
                    App.Instalments.queryById('TxtMablaghNa').setValue("");*/
                    App.Instalments.queryById('txtTarikhSarResidS').setValue(record.get('fldTarikhSarResid'));
                    App.Instalments.queryById('txtTarikhStatusS').setValue(record.get('fldDateStatus'));
                    App.Instalments.queryById('txtShomareSanadS').setValue(record.get('fldShomareSanad'));
                    App.Instalments.queryById('TxtMablaghSanadS').setValue(record.get('fldMablaghSanad'));
                    App.Instalments.queryById('txtDescS').setValue(record.get('fldDesc'));
                    App.Instalments.queryById('CboStatusS').setValue(String(record.get('fldStatus')));
                    App.Instalments.queryById('CboDocType').setValue("3");
                    /*App.Instalments.queryById('SaftehId').setValue(record.get('fldId'));*/
                    /*App.Instalments.queryById('txtTarikhSarResidB').setValue("");
                    App.Instalments.queryById('txtShomareSanadB').setValue("");
                    App.Instalments.queryById('TxtMablaghSanadB').setValue("");
                    App.Instalments.queryById('txtBaratDar').setValue("");
                    App.Instalments.queryById('fldBaratDarId').setValue(0);
                    App.Instalments.queryById('txtMakanPardakhtB').setValue("");
                    App.Instalments.queryById('BaratId').setValue(0);
                    App.Instalments.queryById('txtTarikhSarResidCh').setValue("");
                    App.Instalments.queryById('txtShomareSanadCh').setValue("");
                    App.Instalments.queryById('TxtMablaghSanadCh').setValue("");
                    App.Instalments.queryById('txtShomareHesab').setValue("");
                    App.Instalments.queryById('fldShomareHesabId').setValue(0);
                    App.Instalments.queryById('txtBank').setValue("");
                    App.Instalments.queryById('txtShobe').setValue("");
                    App.Instalments.queryById('CheckId').setValue(0);*/
                }
                else if (record.get('fldTypeSanad') == 4) {/*برات*/
                    App.Instalments.queryById('FieldSetNaghdi').hide();
                    App.Instalments.queryById('FieldSetBarat').show();
                    App.Instalments.queryById('FieldSetSafteh').hide();
                    App.Instalments.queryById('FieldSetCheck').hide();
                    App.Instalments.queryById('FieldSetTalab').hide();
                    App.Instalments.queryById('FieldSetBestankar').hide();
                    /*App.Instalments.queryById('TxtMablaghTa').setValue("");
                    App.Instalments.queryById('Talab_NaghdiId').setValue(0);
                    App.Instalments.queryById('TxtMablaghNa').setValue("");
                    App.Instalments.queryById('txtTarikhSarResidS').setValue("");
                    App.Instalments.queryById('txtShomareSanadS').setValue("");
                    App.Instalments.queryById('TxtMablaghSanadS').setValue("");
                    App.Instalments.queryById('SaftehId').setValue(0);*/
                    App.Instalments.queryById('txtTarikhSarResidB').setValue(record.get('fldTarikhSarResid'));
                    App.Instalments.queryById('txtTarikhStatusB').setValue(record.get('fldDateStatus'));
                    App.Instalments.queryById('txtShomareSanadB').setValue(record.get('fldShomareSanad'));
                    App.Instalments.queryById('TxtMablaghSanadB').setValue(record.get('fldMablaghSanad'));
                    App.Instalments.queryById('txtBaratDar').setValue(record.get('fldNameBaratDar'));
                    App.Instalments.queryById('fldBaratDarId').setValue(record.get('fldBaratDarId'));
                    App.Instalments.queryById('txtMakanPardakhtB').setValue(record.get('fldMakanPardakht'));
                    App.Instalments.queryById('txtDescB').setValue(record.get('fldDesc'));
                    App.Instalments.queryById('CboStatusB').setValue(String(record.get('fldStatus')));
                    App.Instalments.queryById('CboDocType').setValue("4");
                    /*App.Instalments.queryById('BaratId').setValue(record.get('fldId'));*/
                    /*App.Instalments.queryById('txtTarikhSarResidCh').setValue("");
                    App.Instalments.queryById('txtShomareSanadCh').setValue("");
                    App.Instalments.queryById('TxtMablaghSanadCh').setValue("");
                    App.Instalments.queryById('txtShomareHesab').setValue("");
                    App.Instalments.queryById('fldShomareHesabId').setValue(0);
                    App.Instalments.queryById('txtBank').setValue("");
                    App.Instalments.queryById('txtShobe').setValue("");
                    App.Instalments.queryById('CheckId').setValue(0);*/
                }
                else if (record.get('fldTypeSanad') == 5) {/*بدهکاری*/
                    App.Instalments.queryById('FieldSetNaghdi').hide();
                    App.Instalments.queryById('FieldSetBarat').hide();
                    App.Instalments.queryById('FieldSetSafteh').hide();
                    App.Instalments.queryById('FieldSetCheck').hide();
                    App.Instalments.queryById('FieldSetTalab').show();
                    App.Instalments.queryById('FieldSetBestankar').hide();
                    App.Instalments.queryById('TxtMablaghTa').setValue(record.get('fldMablaghSanad'));
                    App.Instalments.queryById('txtDescTa').setValue(record.get('fldDesc'));
                    App.Instalments.queryById('CboDocType').setValue("5");
                    /*App.Instalments.queryById('Talab_NaghdiId').setValue(record.get('fldId'));*/
                    /*App.Instalments.queryById('TxtMablaghNa').setValue("");
                    App.Instalments.queryById('txtTarikhSarResidS').setValue("");
                    App.Instalments.queryById('txtShomareSanadS').setValue("");
                    App.Instalments.queryById('TxtMablaghSanadS').setValue("");
                    App.Instalments.queryById('SaftehId').setValue(0);
                    App.Instalments.queryById('txtTarikhSarResidB').setValue("");
                    App.Instalments.queryById('txtShomareSanadB').setValue("");
                    App.Instalments.queryById('TxtMablaghSanadB').setValue("");
                    App.Instalments.queryById('txtBaratDar').setValue("");
                    App.Instalments.queryById('fldBaratDarId').setValue(0);
                    App.Instalments.queryById('txtMakanPardakhtB').setValue("");
                    App.Instalments.queryById('BaratId').setValue(0);
                    App.Instalments.queryById('txtTarikhSarResidCh').setValue("");
                    App.Instalments.queryById('txtShomareSanadCh').setValue("");
                    App.Instalments.queryById('TxtMablaghSanadCh').setValue("");
                    App.Instalments.queryById('txtShomareHesab').setValue("");
                    App.Instalments.queryById('fldShomareHesabId').setValue(0);
                    App.Instalments.queryById('txtBank').setValue("");
                    App.Instalments.queryById('txtShobe').setValue("");
                    App.Instalments.queryById('CheckId').setValue(0);*/
                }

                else if (record.get('fldTypeSanad') == 7) {/*بستانکاری*/
                    App.Instalments.queryById('FieldSetNaghdi').hide();
                    App.Instalments.queryById('FieldSetBarat').hide();
                    App.Instalments.queryById('FieldSetSafteh').hide();
                    App.Instalments.queryById('FieldSetCheck').hide();
                    App.Instalments.queryById('FieldSetTalab').hide();
                    App.Instalments.queryById('FieldSetBestankar').show();
                    App.Instalments.queryById('TxtMablaghBes').setValue(record.get('fldMablaghSanad'));
                    App.Instalments.queryById('txtDescBes').setValue(record.get('fldDesc'));
                    App.Instalments.queryById('CboDocType').setValue("7");
                    /*App.Instalments.queryById('Talab_NaghdiId').setValue(record.get('fldId'));*/
                    /*App.Instalments.queryById('TxtMablaghNa').setValue("");
                    App.Instalments.queryById('txtTarikhSarResidS').setValue("");
                    App.Instalments.queryById('txtShomareSanadS').setValue("");
                    App.Instalments.queryById('TxtMablaghSanadS').setValue("");
                    App.Instalments.queryById('SaftehId').setValue(0);
                    App.Instalments.queryById('txtTarikhSarResidB').setValue("");
                    App.Instalments.queryById('txtShomareSanadB').setValue("");
                    App.Instalments.queryById('TxtMablaghSanadB').setValue("");
                    App.Instalments.queryById('txtBaratDar').setValue("");
                    App.Instalments.queryById('fldBaratDarId').setValue(0);
                    App.Instalments.queryById('txtMakanPardakhtB').setValue("");
                    App.Instalments.queryById('BaratId').setValue(0);
                    App.Instalments.queryById('txtTarikhSarResidCh').setValue("");
                    App.Instalments.queryById('txtShomareSanadCh').setValue("");
                    App.Instalments.queryById('TxtMablaghSanadCh').setValue("");
                    App.Instalments.queryById('txtShomareHesab').setValue("");
                    App.Instalments.queryById('fldShomareHesabId').setValue(0);
                    App.Instalments.queryById('txtBank').setValue("");
                    App.Instalments.queryById('txtShobe').setValue("");
                    App.Instalments.queryById('CheckId').setValue(0);*/
                }
            }
        }
        else if (command == "RptBankCommand") {
            Ext.net.Mask.show({ msg: 'در حال چاپ گزارش...' });
            Ext.net.DirectMethod.request({
                url: '/Daramad/instalments/PrintCheck',
                params: {
                    CheckId: record.get('fldId'),
                    OrganId: '@ViewBag.OrganId',
                    ReplyTaghsitId: 0
                },
                success: function () {
                    Ext.net.Mask.hide();
                }
            });
        }
        else if (command == "BackCommand") {
            if (record.modified.fldStatus == undefined) {/*داده اصلی*/
                if (record.get('fldStatus') == 5) {
                    Ext.MessageBox.show({
                        title: "خطا",
                        msg: "سند مورد نظر قبلا عودت داده شده است.",
                        icon: Ext.MessageBox.ERROR,
                        buttons: Ext.MessageBox.OK
                    });
                }
                else if (record.get('fldStatus') == 2) {
                    Ext.MessageBox.show({
                        title: "خطا",
                        msg: "سند مورد نظر وصول شده و امکان عودت آن وجود ندارد.",
                        icon: Ext.MessageBox.ERROR,
                        buttons: Ext.MessageBox.OK
                    });
                }
                else {
                    var win = Ext.create('Ext.window.Window', {
                        title: 'عودت',
                        width: 270,
                        height: 170,
                        id: "BackWin",
                        closable: true,
                        closseAction: "destroy",
                        resizable: false,
                        layout: {
                            type: 'vbox',
                            align: 'center'
                        },
                        modal: true,
                        buttonAlign: 'center',
                        buttons: [{
                            xtype: 'button',
                            text: 'تأیید',
                            colSpan: 2,
                            width: 50,
                            listeners: {
                                click: function (button) {
                                    if (win.queryById('dateforback').validate() == false) { return; }
                                    var dateforback = win.queryById('dateforback').getRawValue();
                                    var txtDescBack = win.queryById('txtDescBack').getValue();
                                    Ext.MessageBox.show({
                                        title: "هشدار",
                                        msg: "آیا جهت عودت سند مطمئن هستید؟ در صورت ذخیره امکان ویرایش وجود ندارد.",
                                        icon: Ext.MessageBox.WARNING,
                                        buttons: Ext.MessageBox.YESNO,
                                        fn: function (btn) {
                                            if (btn == "yes") {
                                                win.destroy();
                                                record.set('fldStatus', 5);
                                                record.set('fldStatusName', "عودت داده شده");
                                                record.set('fldDesc', txtDescBack);
                                                record.set('fldDateStatus', dateforback);
                                                totalDocMablagh();
                                            }
                                        }
                                    });
                                }
                            }
                        }],
                        items: [
                        {
                            xtype: "panel",
                            border: false,
                            layout: {
                                type: 'table',
                                columns: '2'
                            },
                            items: [
                            {
                                xtype: 'label',
                                text: "تاریخ عودت:"
                            },
                            {
                                xtype: 'pdatefield',
                                itemId: 'dateforback',
                                value: record.get('fldDateStatus'),
                                editable: false,
                                margin: "5px",
                                allowBlank: false,
                                blankText: "لطفاً تاریخ عودت را وارد نمایید."
                            },
                            {
                                xtype: 'label',
                                text: "توضیحات:"
                            },
                            {
                                xtype: 'textarea',
                                itemId: 'txtDescBack',
                                margin: "5px",
                                value: record.get('fldDesc')
                            }]
                        }]
                    });
                    win.show();
                }
            }
            else {
                if (record.modified.fldStatus == 5) {
                    Ext.MessageBox.show({
                        title: "خطا",
                        msg: "سند مورد نظر قبلا عودت داده شده است.",
                        icon: Ext.MessageBox.ERROR,
                        buttons: Ext.MessageBox.OK
                    });
                }
                else if (record.modified.fldStatus == 2) {
                    Ext.MessageBox.show({
                        title: "خطا",
                        msg: "سند مورد نظر وصول شده و امکان عودت آن وجود ندارد.",
                        icon: Ext.MessageBox.ERROR,
                        buttons: Ext.MessageBox.OK
                    });
                }
                else {
                    var win = Ext.create('Ext.window.Window', {
                        title: 'عودت',
                        width: 290,
                        height: 170,
                        id: "BackWin",
                        closable: true,
                        closseAction: "destroy",
                        resizable: false,
                        layout: {
                            type: 'vbox',
                            align: 'center'
                        },
                        modal: true,
                        buttonAlign: 'center',
                        buttons: [{
                            xtype: 'button',
                            text: 'تأیید',
                            colSpan: 2,
                            width: 50,
                            listeners: {
                                click: function (button) {
                                    if (win.queryById('dateforback').validate() == false) { return; }
                                    var dateforback = win.queryById('dateforback').getRawValue();
                                    var txtDescBack = win.queryById('txtDescBack').getValue();
                                    Ext.MessageBox.show({
                                        title: "هشدار",
                                        msg: "آیا جهت عودت سند مطمئن هستید؟ در صورت ذخیره امکان ویرایش وجود ندارد.",
                                        icon: Ext.MessageBox.WARNING,
                                        buttons: Ext.MessageBox.YESNO,
                                        fn: function (btn) {
                                            if (btn == "yes") {
                                                win.destroy();
                                                record.set('fldStatus', 5);
                                                record.set('fldStatusName', "عودت داده شده");
                                                record.set('fldDesc', txtDescBack);
                                                record.set('fldDateStatus', dateforback);
                                                totalDocMablagh();
                                            }
                                        }
                                    });
                                }
                            }
                        }],
                        items: [
                        {
                            xtype: "panel",
                            border: false,
                            layout: {
                                type: 'table',
                                columns: '2'
                            },
                            items: [
                            {
                                xtype: 'label',
                                text: "تاریخ عودت:"
                            },
                            {
                                xtype: 'pdatefield',
                                itemId: 'dateforback',
                                value: record.get('fldDateStatus'),
                                editable: false,
                                margin: "5px",
                                allowBlank: false,
                                blankText: "لطفاً تاریخ عودت را وارد نمایید."
                            },
                            {
                                xtype: 'label',
                                text: "توضیحات:"
                            },
                            {
                                xtype: 'textarea',
                                itemId: 'txtDescBack',
                                margin: "5px",
                                value: record.get('fldDesc')
                            }]
                        }]
                    });
                    win.show();
                }
            }
            @*Ext.MessageBox.show({
                title: "هشدار",
                msg: "آیا جهت عودت سند مطمئن هستید؟ در صورت ذخیره امکان ویرایش وجود ندارد.",
                icon: Ext.MessageBox.WARNING,
                buttons: Ext.MessageBox.YESNO,
                fn: function (btn) {
                    if (btn == "yes") {
                        if (record.modified.fldStatus == undefined) {/*داده اصلی*/
                            if (record.get('fldStatus') == 5) {
                                Ext.MessageBox.show({
                                    title: "خطا",
                                    msg: "سند مورد نظر قبلا عودت داده شده است.",
                                    icon: Ext.MessageBox.ERROR,
                                    buttons: Ext.MessageBox.OK
                                });
                            }
                            else if (record.get('fldStatus') == 2) {
                                Ext.MessageBox.show({
                                    title: "خطا",
                                    msg: "سند مورد نظر وصول شده و امکان عودت آن وجود ندارد.",
                                    icon: Ext.MessageBox.ERROR,
                                    buttons: Ext.MessageBox.OK
                                });
                            }
                            else {
                                record.set('fldStatus', 5);
                                record.set('fldStatusName', "عودت داده شده");
                                totalDocMablagh();
                            }
                        }
                        else {
                            if (record.modified.fldStatus == 5) {
                                Ext.MessageBox.show({
                                    title: "خطا",
                                    msg: "سند مورد نظر قبلا عودت داده شده است.",
                                    icon: Ext.MessageBox.ERROR,
                                    buttons: Ext.MessageBox.OK
                                });
                            }
                            else if (record.modified.fldStatus == 2) {
                                Ext.MessageBox.show({
                                    title: "خطا",
                                    msg: "سند مورد نظر وصول شده و امکان عودت آن وجود ندارد.",
                                    icon: Ext.MessageBox.ERROR,
                                    buttons: Ext.MessageBox.OK
                                });
                            }
                            else {
                                record.set('fldStatus', 5);
                                record.set('fldStatusName', "عودت داده شده");
                                totalDocMablagh();
                            }
                        }
                        /*Ext.net.Mask.show({ msg: 'در حال انجام عملیات...' });
                        Ext.net.DirectMethod.request({
                            url: '/Daramad/instalments/BackDoc',
                            params: {
                                Id: record.data.fldId,
                                Type: record.data.fldTypeSanad
                            },
                            success: function (data) {
                                var ic = Ext.MessageBox.INFO;
                                if (data.Er == 1) {
                                    ic = Ext.MessageBox.ERROR;
                                }
                                Ext.MessageBox.show({
                                    title: data.MsgTitle,
                                    msg: data.Msg,
                                    icon: ic,
                                    buttons: Ext.MessageBox.OK
                                });
                                Ext.net.Mask.hide();
                            }
                        });*/
                    }
                }
            });*@
        }
    };

    function SaveInstalments() {
        var store = App.Instalments.queryById('InstalmentsGrid').store;
        var sum = 0;
        store.each(function (rec) {
            if (rec.get('fldTypeSanad') != 6 && rec.get('fldStatus') != 5) {
                if (rec.get('fldTypeSanad') == 7) {
                    sum -= rec.get('fldMablaghSanad');
                }
                else {
                    sum += rec.get('fldMablaghSanad');
                }
            }
        });

        if (sum != parseInt('@ViewBag.fldMablaghGHabelPardakht')) {
            Ext.MessageBox.show({
                title: "خطا",
                msg: "مقادیر جمع کل و جمع وصولی تراز نیستند.",
                icon: Ext.MessageBox.ERROR,
                buttons: Ext.MessageBox.OK
            });
        }
        else {
            Ext.net.Mask.show({ msg: 'در حال ذخیره سازی...' });
            var DocumentsArray = new Array();
            var Grid = App.Instalments.queryById('InstalmentsGrid');
            for (var i = 0; i < Grid.selModel.store.count() ; i++) {
                var row = Grid.selModel.store.data.items[i];
                DocumentsArray.push({
                    'fldId': row.data.fldId,
                    'fldTarikhSarResid': row.data.fldTarikhSarResid,
                    'fldDateStatus': row.data.fldDateStatus,
                    'fldShomareSanad': row.data.fldShomareSanad,
                    'fldMablaghSanad': row.data.fldMablaghSanad,
                    'fldStatus': row.data.fldStatus,
                    'fldShomareHesabId': row.data.fldShomareHesabId,
                    'fldShomareHesabIdOrgan': row.data.fldShomareHesabIdOrgan,
                    'fldBaratDarId': row.data.fldBaratDarId,
                    'fldTypeSanad': row.data.fldTypeSanad,
                    'fldMakanPardakht': row.data.fldMakanPardakht,
                    'fldDesc': row.data.fldDesc,
                });
            }

            var data1 = {
                DocumentsArray: DocumentsArray,
                fldReplyTaghsitId: '@ViewBag.ReplyTaghsitId',
                DelArray: DelArray
            };

            $.ajax({
                type: "POST",
                url: '/Daramad/instalments/Save',
                datatype: "json",
                data: JSON.stringify(data1),
                contentType: "application/json; charset=utf-8",
                success: function (data) {
                    Ext.net.Mask.hide();
                    var result = data;/* JSON.parse(data);*/
                    if (result.Er == 1) {
                        var NotSuccessSerial = result.NotSuccessSerial.split(";");
                        var msg = "";
                        for (var i = 0; i < NotSuccessSerial.length - 1; i++) {
                            msg = msg + NotSuccessSerial[i] + "</br>";
                        }
                        Ext.MessageBox.show({
                            rtl: true,
                            title: "خطا",
                            msg: msg,
                            icon: Ext.MessageBox.ERROR,
                            buttons: Ext.MessageBox.OK
                        });
                        App.Instalments.queryById('InstalmentsGrid').store.load();
                    }
                    else {
                        Ext.MessageBox.show({
                            title: "عملیات موفق",
                            msg: "عملیات با موفقیت انجام شد.",
                            icon: Ext.MessageBox.INFO,
                            buttons: Ext.MessageBox.OK
                        });
                        App.Instalments.queryById('InstalmentsGrid').store.load();
                        ClearDocItems();
                    }
                    Ext.net.Mask.hide();
                },
                failure: function (data) {
                    alert(data.data);
                }
            });
        }
    }

    var addKeyMapInstalments = function (cmp) {
        this.keyMap = new Ext.util.KeyMap({
            target: cmp.getEl(),
            binding: [{
                key: [13, 9], /*Ext.EventObject.ENTER,*/
                fn: function (key, e) {
                    if (e.getKey() == 9) {
                        e.stopEvent();
                    }
                    var keyfield = App.Instalments.queryById(Ext.getCmp((Ext.Element.getActiveElement()).name).itemId);
                    var nextfld;
                    if (App.Instalments.queryById("FieldSetNaghdi").isVisible()) {
                        if (keyfield.itemId == "txtDescNa") {
                            nextfld = App.Instalments.queryById("btnSanadNaghdi");
                            nextfld.focus();
                            setFieldIn('FieldSetNaghdi');
                            return;
                        }
                    }
                    else if (App.Instalments.queryById("FieldSetTalab").isVisible()) {
                        if (keyfield.itemId == "txtDescTa") {
                            nextfld = App.Instalments.queryById("btnSanadTalab");
                            nextfld.focus();
                            setFieldIn('FieldSetTalab');
                            return;
                        }
                    }
                    else if (App.Instalments.queryById("FieldSetBestankar").isVisible()) {
                        if (keyfield.itemId == "txtDescBes") {
                            nextfld = App.Instalments.queryById("btnSanadBes");
                            nextfld.focus();
                            setFieldIn('FieldSetBestankar');
                            return;
                        }
                    }
                    else if (App.Instalments.queryById("FieldSetSafteh").isVisible()) {
                        if (keyfield.itemId == "txtDescS") {
                            nextfld = App.Instalments.queryById("btnSanadSafte");
                            nextfld.focus();
                            setFieldIn('FieldSetSafteh');
                            return;
                        }
                    }
                    else if (App.Instalments.queryById("FieldSetBarat").isVisible()) {
                        if (keyfield.itemId == "txtDescB") {
                            nextfld = App.Instalments.queryById("btnSanadBarat");
                            nextfld.focus();
                            setFieldIn('FieldSetBarat');
                            return;
                        }
                    }
                    else if (App.Instalments.queryById("FieldSetCheck").isVisible()) {
                        if (keyfield.itemId == "txtDescCh") {
                            nextfld = App.Instalments.queryById("btnSanadCh");
                            nextfld.focus();
                            setFieldIn('FieldSetCheck');
                            return;
                        }
                        else if (keyfield.itemId == "txtShomareHesab") {
                            nextfld = App.Instalments.queryById('CboStatusCh');
                            nextfld.focus();
                            nextfld.selectText();
                            return;
                        }
                    }
                    nextfld = keyfield.nextSibling().nextSibling();
                    nextfld.focus();
                    nextfld.selectText();
                }
            }]
        });
    };

    function ClearDocItems(filed) {
        /*if (field == "FieldSetNaghdi") {*/
        if (App.Instalments.queryById('TxtMablaghNa').getValue().replace(',', '').replace(',', '').replace(',', '').replace(',', '').replace(',', '') != '@ViewBag.fldMablaghNaghdi') {
            App.Instalments.queryById('TxtMablaghNa').setValue("");
        }
        if (App.Instalments.queryById('txtShomareHesabPardakht_N').getValue() != '@ViewBag.fldShomareHesabPishfarz') {
            App.Instalments.queryById('txtShomareHesabPardakht_N').setValue("");
            App.Instalments.queryById('fldShomareHesabIdPardakht_N').setValue(0);
        }

        App.Instalments.queryById('Talab_NaghdiId').setValue(0);
        App.Instalments.queryById('txtDescNa').setValue("");
        /*}
        else if (field == "FieldSetTalab") {*/
        App.Instalments.queryById('TxtMablaghTa').setValue("");
        /*App.Instalments.queryById('Talab_NaghdiId').setValue(0);*/
        App.Instalments.queryById('txtDescTa').setValue("");

        App.Instalments.queryById('TxtMablaghBes').setValue("");
        App.Instalments.queryById('txtDescBes').setValue("");

        /*}
        else if (field == "FieldSetSafteh") {*/
        App.Instalments.queryById('txtTarikhSarResidS').setValue("");
        App.Instalments.queryById('txtTarikhStatusS').setValue("");
        App.Instalments.queryById('txtShomareSanadS').setValue("");
        App.Instalments.queryById('TxtMablaghSanadS').setValue("");
        App.Instalments.queryById('txtDescS').setValue("");
        App.Instalments.queryById('SaftehId').setValue(0);
        /*}
        else if (field == "FieldSetBarat") {*/
        App.Instalments.queryById('txtTarikhSarResidB').setValue("");
        App.Instalments.queryById('txtTarikhStatusB').setValue("");
        App.Instalments.queryById('txtShomareSanadB').setValue("");
        App.Instalments.queryById('TxtMablaghSanadB').setValue("");
        App.Instalments.queryById('txtBaratDar').setValue("");
        App.Instalments.queryById('fldBaratDarId').setValue(0);
        App.Instalments.queryById('txtMakanPardakhtB').setValue("");
        App.Instalments.queryById('BaratId').setValue(0);
        App.Instalments.queryById('txtDescB').setValue("");
        /*}
        else if (field == "FieldSetCheck") {*/
        App.Instalments.queryById('txtTarikhSarResidCh').setValue("");
        App.Instalments.queryById('txtTarikhStatusCh').setValue("");
        App.Instalments.queryById('txtShomareSanadCh').setValue("");
        App.Instalments.queryById('TxtMablaghSanadCh').setValue("");
        App.Instalments.queryById('txtShomareHesab').setValue("");
        App.Instalments.queryById('fldShomareHesabId').setValue(0);
        if (App.Instalments.queryById('txtShomareHesabPardakht').getValue() != '@ViewBag.fldShomareHesabPishfarz') {
            App.Instalments.queryById('txtShomareHesabPardakht').setValue("");
            App.Instalments.queryById('fldShomareHesabIdPardakht').setValue(0);
        }
        App.Instalments.queryById('txtBank').setValue("");
        App.Instalments.queryById('txtShobe').setValue("");
        App.Instalments.queryById('CheckId').setValue(0);
        App.Instalments.queryById('txtDescCh').setValue("");
        /*}*/
    }
</script>